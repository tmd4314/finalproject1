import{d as te,a as oe,n as u,c as S,x as ae,o as ne,e as i,f as v,p as V,i as r,j as l,w as s,v as U,t as d,g as O,q as F,m as I,_ as se}from"./index-KTdWOH4t.js";import{u as N,w as le}from"./xlsx-DjuO7_Ju.js";const re={class:"equipment-inquiry-page"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ue={class:"flex justify-end gap-2 mt-4"},ie={class:"flex items-center"},de={class:"flex justify-between items-center mb-4"},pe={class:"va-h5"},_e={class:"flex gap-2"},me={class:"flex items-center"},fe={class:"flex items-center"},ve={class:"font-semibold text-primary cursor-pointer"},ye={class:"font-medium"},ge={class:"text-sm"},he={class:"text-sm text-secondary"},be={key:1,class:"text-sm text-secondary"},qe={key:0,class:"text-center py-8 text-secondary"},xe=te({__name:"EquipmentInquiry",setup(Ce){const R=oe(),y=u(!1),b=u(!1),q=u(!1),w=u([]),x=u([]),p=u(30),E=u(0),a=u({equipmentCode:"",equipmentName:"",category:"",status:""}),$=u([]),L=u([]);let C=null;const H=[{key:"eq_id",label:"설비 번호",sortable:!0},{key:"eq_name",label:"설비명",sortable:!0},{key:"eq_group_name",label:"분류",sortable:!0},{key:"location",label:"위치",sortable:!0},{key:"eq_run_name",label:"설비상태",sortable:!0},{key:"inspection_status",label:"점검상태(일시)"},{key:"inspection_type_name",label:"점검유형"}],P=S(()=>!!(a.value.equipmentCode||a.value.equipmentName||a.value.category||a.value.status)),_=S(()=>w.value.filter(e=>!(a.value.equipmentCode&&!e.eq_id.toString().toLowerCase().includes(a.value.equipmentCode.toLowerCase())||a.value.equipmentName&&!e.eq_name.toLowerCase().includes(a.value.equipmentName.toLowerCase())||a.value.category&&e.eq_group_code!==a.value.category||a.value.status&&e.eq_run_code!==a.value.status))),M=S(()=>p.value<_.value.length),z=()=>{x.value=_.value.slice(0,p.value)};ae(_,e=>{E.value=e.length,z()});const Y=async()=>{y.value=!0;try{const t=(await U.get("/equipments/inquiry")).data;t.isSuccessed&&(w.value=t.data,z())}catch(e){console.error("설비 목록 불러오기 실패:",e),alert("설비 목록을 불러올 수 없습니다.")}finally{y.value=!1}},A=async()=>{try{const t=(await U.get("/common-codes?groups=0E,0S")).data;$.value=t["0E"]||[],L.value=t["0S"]||[]}catch(e){console.error("공통코드 불러오기 실패:",e)}},g=()=>{C&&clearTimeout(C),C=setTimeout(()=>{P.value?p.value=Math.max(_.value.length,999999):p.value=30},300)},G=()=>{b.value=!0,setTimeout(()=>{p.value+=30,b.value=!1},300)},J=()=>{a.value={equipmentCode:"",equipmentName:"",category:"",status:""},p.value=30},K=e=>{R.push(`/equipments/${e.item.eq_id}`)},Q=e=>({e1:"primary",e2:"success",e3:"warning"})[e]||"secondary",W=e=>({s1:"success",s2:"info",s3:"danger"})[e]||"secondary",X=e=>({n1:"info",n2:"success",n3:"primary",n4:"danger"})[e]||"secondary",B=e=>{const t=[];return e.factory_name&&t.push(e.factory_name),e.floor_name&&t.push(e.floor_name),e.room_name&&t.push(e.room_name),t.join(" > ")||"-"},j=e=>{if(!e||e==="")return"-";try{if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(e))return e.replace("-",".").replace("-",".");if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e.replace(/-/g,".")}const t=new Date(e);if(isNaN(t.getTime()))return"-";const c=t.getFullYear(),f=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),h=String(t.getMinutes()).padStart(2,"0");return`${c}.${f}.${m} ${n}:${h}`}catch(t){return console.error("날짜 포맷팅 오류:",t,"Input:",e),"-"}},T=e=>!e||e===""?"-":typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e)?e.replace(/-/g,"."):e||"-",Z=async()=>{if(_.value.length===0){alert("내보낼 데이터가 없습니다.");return}q.value=!0;try{const e=_.value.map(n=>({"설비 번호":n.eq_id,설비명:n.eq_name,분류:n.eq_group_name||n.eq_group_code,위치:B(n),설비상태:n.eq_run_name||n.eq_run_code,"점검상태(일시)":n.inspection_status?j(n.inspection_status):"점검 이력 없음",점검유형:n.inspection_type_name||"-",제조사:n.eq_manufacturer||"-",모델명:n.eq_model||"-",제조일자:T(n.eq_manufacture_date),등록일자:T(n.eq_registration_date)})),t=N.json_to_sheet(e),c=N.book_new();N.book_append_sheet(c,t,"설비 목록");const m=`설비목록_${new Date().toISOString().slice(0,10)}.xlsx`;le(c,m)}catch(e){console.error("엑셀 내보내기 실패:",e),alert("엑셀 파일 생성에 실패했습니다.")}finally{q.value=!1}};return ne(()=>{Y(),A()}),(e,t)=>{const c=i("VaIcon"),f=i("VaInput"),m=i("VaSelect"),n=i("VaButton"),h=i("VaCardContent"),D=i("VaCard"),k=i("VaChip"),ee=i("VaDataTable");return v(),V("div",re,[t[8]||(t[8]=r("h1",{class:"va-h3 mb-6"},"설비 조회",-1)),l(D,{class:"mb-6"},{default:s(()=>[l(h,null,{default:s(()=>[t[5]||(t[5]=r("h2",{class:"va-h5 mb-4"},"검색 조건",-1)),r("div",ce,[l(f,{modelValue:a.value.equipmentCode,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.equipmentCode=o),label:"설비번호",placeholder:"설비번호를 입력하세요",clearable:"",onInput:g},{appendInner:s(()=>[l(c,{name:"search",color:"secondary"})]),_:1},8,["modelValue"]),l(f,{modelValue:a.value.equipmentName,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.equipmentName=o),label:"설비명",placeholder:"설비명을 입력하세요",clearable:"",onInput:g},{appendInner:s(()=>[l(c,{name:"search",color:"secondary"})]),_:1},8,["modelValue"]),l(m,{modelValue:a.value.category,"onUpdate:modelValue":[t[2]||(t[2]=o=>a.value.category=o),g],label:"설비분류",options:$.value,"text-by":"label","value-by":"value",clearable:"",placeholder:"전체"},null,8,["modelValue","options"]),l(m,{modelValue:a.value.status,"onUpdate:modelValue":[t[3]||(t[3]=o=>a.value.status=o),g],label:"설비상태",options:L.value,"text-by":"label","value-by":"value",clearable:"",placeholder:"전체"},null,8,["modelValue","options"])]),r("div",ue,[l(n,{color:"secondary",onClick:J},{default:s(()=>[r("div",ie,[l(c,{name:"refresh",size:"16px",class:"mr-1"}),t[4]||(t[4]=r("span",null,"초기화",-1))])]),_:1})])]),_:1,__:[5]})]),_:1}),l(D,null,{default:s(()=>[l(h,null,{default:s(()=>[r("div",de,[r("h2",pe,"설비 목록 (총 "+d(E.value)+"개)",1),r("div",_e,[M.value?(v(),O(n,{key:0,color:"info",onClick:G,loading:b.value,disabled:!M.value},{default:s(()=>[r("div",me,[l(c,{name:"expand_more",size:"16px",class:"mr-1"}),t[6]||(t[6]=r("span",null,"더보기",-1))])]),_:1},8,["loading","disabled"])):F("",!0),l(n,{color:"success",onClick:Z,loading:q.value},{default:s(()=>[r("div",fe,[l(c,{name:"file_download",size:"16px",class:"mr-1"}),t[7]||(t[7]=r("span",null,"엑셀 다운로드",-1))])]),_:1},8,["loading"])])]),l(ee,{items:x.value,columns:H,loading:y.value,hoverable:"","sticky-header":"",clickable:"","onRow:click":K},{"cell(eq_id)":s(({rowData:o})=>[r("span",ve,d(o.eq_id),1)]),"cell(eq_name)":s(({rowData:o})=>[r("span",ye,d(o.eq_name),1)]),"cell(eq_group_name)":s(({rowData:o})=>[l(k,{color:Q(o.eq_group_code),size:"small",flat:""},{default:s(()=>[I(d(o.eq_group_name||o.eq_group_code),1)]),_:2},1032,["color"])]),"cell(location)":s(({rowData:o})=>[r("span",ge,d(B(o)),1)]),"cell(eq_run_name)":s(({rowData:o})=>[l(k,{color:W(o.eq_run_code),size:"small",flat:""},{default:s(()=>[I(d(o.eq_run_name||o.eq_run_code),1)]),_:2},1032,["color"])]),"cell(inspection_status)":s(({rowData:o})=>[r("span",he,d(o.inspection_status?j(o.inspection_status):"점검 이력 없음"),1)]),"cell(inspection_type_name)":s(({rowData:o})=>[o.inspection_type_name?(v(),O(k,{key:0,color:o.inspection_type_code?X(o.inspection_type_code):"secondary",size:"small",flat:""},{default:s(()=>[I(d(o.inspection_type_name),1)]),_:2},1032,["color"])):(v(),V("span",be,"-"))]),_:1},8,["items","loading"]),x.value.length===0&&!y.value?(v(),V("div",qe," 조회된 설비가 없습니다. ")):F("",!0)]),_:1})]),_:1})])}}}),Ve=se(xe,[["__scopeId","data-v-2de4b1ac"]]);export{Ve as default};
//# sourceMappingURL=EquipmentInquiry-Cn3gxOru.js.map
