{"version":3,"file":"receivingManagementPage-DfHmuKQt.js","sources":["../../../client/src/pages/material/receivingManagementPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"receipt-page\">\r\n    <h2 class=\"page-title\">자재 입고</h2>\r\n\r\n    <!-- 발주 리스트 -->\r\n    <div class=\"table-section\">\r\n      <h3 class=\"table-title\">발주 리스트</h3>\r\n      <va-data-table\r\n        :items=\"orderCheckList\"\r\n        :columns=\"orderColumns\"\r\n        :per-page=\"5\"\r\n        :current-page.sync=\"orderPage\"\r\n        track-by=\"purchase_order_id\"\r\n      >\r\n        <template #cell(purchase_order_date)=\"{ row }\">\r\n          {{ formatToKST(row.source.purchase_order_date) }}\r\n        </template>\r\n\r\n        <template #cell(receive_qty)=\"{ row }\">\r\n          <va-input\r\n            v-model=\"row.source.receive_qty\"\r\n            type=\"number\"\r\n            min=\"1\"\r\n            placeholder=\"수령 수\"\r\n          />\r\n        </template>\r\n\r\n        <template #cell(select)=\"{ row }\">\r\n          <va-checkbox\r\n            :model-value=\"selectedRows.some(r => r.purchase_order_id === row.source.purchase_order_id)\"\r\n            @update:modelValue=\"checked => {\r\n              if (checked) {\r\n                selectedRows.push(row.source)\r\n              } else {\r\n                const index = selectedRows.findIndex(r => r.purchase_order_id === row.source.purchase_order_id)\r\n                if (index !== -1) selectedRows.splice(index, 1)\r\n              }\r\n            }\"\r\n            :disabled=\"!row.source.receive_qty\"\r\n          />\r\n        </template>\r\n      </va-data-table>\r\n      <va-button class=\"mt-4\" @click=\"handleReceive\" :disabled=\"selectedRows.length === 0\">\r\n        선택 항목 수령\r\n      </va-button>\r\n    </div>\r\n\r\n    <!-- 자재 입고 등록 -->\r\n    <div class=\"table-section\">\r\n      <h3 class=\"table-title\">입고 자재</h3>\r\n      <va-data-table\r\n        :items=\"materialOrderList\"\r\n        :columns=\"receiptColumns\"\r\n        :per-page=\"5\"\r\n        :current-page.sync=\"receiptPage\"\r\n        track-by=\"material_code\"\r\n      >\r\n        <template #cell(material_expiration_date)=\"{ row }\">\r\n          {{ formatToKST(row.source.material_expiration_date) }}\r\n        </template>\r\n\r\n        <template #cell(lot_number)=\"{ row }\">\r\n          {{ generateLotNumber(row.source.material_code) }}\r\n        </template>\r\n\r\n        <template #cell(action)=\"{ row }\">\r\n          <va-button size=\"small\" @click=\"saveMaterialLot(row.source)\">입고</va-button>\r\n        </template>\r\n      </va-data-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport axios from 'axios'\r\nimport { ref, onMounted } from 'vue'\r\n\r\ninterface MaterialReceipt {\r\n  purchase_order_id: string\r\n  material_code: string\r\n  material_name: string\r\n  purchase_order_quantity: number\r\n  received_quantity: number\r\n  material_unit: string\r\n  mat_qual_test_status: string\r\n  lot_number: string\r\n  material_expiration_date: string\r\n  purchase_order_date: string\r\n  account_id: string\r\n  account_name: string\r\n  receive_qty?: number\r\n}\r\n\r\nconst formatToKST = (isoDate: string): string => {\r\n  const date = new Date(isoDate)\r\n  const kst = new Date(date.getTime() + 9 * 60 * 60 * 1000)\r\n  return `${kst.getFullYear()}-${String(kst.getMonth() + 1).padStart(2, '0')}-${String(kst.getDate()).padStart(2, '0')} ${String(kst.getHours()).padStart(2, '0')}:${String(kst.getMinutes()).padStart(2, '0')}`\r\n}\r\n\r\nconst toDateOnly = (iso: string): string => iso.split('T')[0]\r\n\r\nconst generateLotNumber = (materialCode: string): string => {\r\n  const now = new Date()\r\n  const yyyyMMdd = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`\r\n  const random = Math.floor(100 + Math.random() * 900)\r\n  return `LOT${materialCode}-${yyyyMMdd} - ${random}`\r\n}\r\n\r\nconst materialOrderList = ref<MaterialReceipt[]>([])\r\nconst orderCheckList = ref<MaterialReceipt[]>([])\r\nconst orderPage = ref(1)\r\nconst receiptPage = ref(1)\r\nconst selectedRows = ref<MaterialReceipt[]>([])\r\n\r\nconst orderColumns = [\r\n  { key: 'select', label: '선택' },\r\n  { key: 'purchase_order_id', label: '발주코드' },\r\n  { key: 'material_code', label: '자재코드' },\r\n  { key: 'material_name', label: '자재명' },\r\n  { key: 'material_unit', label: '단위' },\r\n  { key: 'purchase_order_quantity', label: '발주 수량' },\r\n  { key: 'received_quantity', label: '받은 수량' },\r\n  { key: 'receive_qty', label: '수령 수량' },\r\n  { key: 'purchase_order_date', label: '발주일' },\r\n  { key: 'account_id', label: '거래처코드' },\r\n  { key: 'account_name', label: '거래처명' },\r\n]\r\n\r\nconst receiptColumns = [\r\n  { key: 'purchase_order_id', label: '발주코드' },\r\n  { key: 'material_code', label: '자재코드' },\r\n  { key: 'material_name', label: '자재명' },\r\n  { key: 'purchase_order_quantity', label: '입고 수량' },\r\n  { key: 'material_unit', label: '단위' },\r\n  { key: 'material_expiration_date', label: '유통기한' },\r\n  { key: 'lot_number', label: 'LOT번호' },\r\n  { key: 'action', label: '입고' },\r\n]\r\n\r\nconst fetchMaterialsOrder = async () => {\r\n  const res = await axios.get('/materialLot')\r\n  materialOrderList.value = res.data\r\n}\r\n\r\nconst fetchOrder = async () => {\r\n  const res = await axios.get('/orderCheck')\r\n  orderCheckList.value = res.data\r\n}\r\n\r\nconst saveMaterialLot = async (item: MaterialReceipt) => {\r\n  const lotNum = generateLotNumber(item.material_code)\r\n  const payload = {\r\n    lot_number: lotNum,\r\n    material_code: item.material_code,\r\n    expiry_date: toDateOnly(item.material_expiration_date),\r\n    quantity: item.purchase_order_quantity,\r\n    purchase_order_id: item.purchase_order_id,\r\n  }\r\n\r\n  const res = await axios.post('/materialLot', payload)\r\n  const res2 = await axios.put(`/materialLot/${payload.purchase_order_id}`)\r\n  if (res.data.isSuccessed && res2.data.isUpdated) {\r\n    alert('LOT 등록 완료!')\r\n    await fetchMaterialsOrder()\r\n  } else {\r\n    alert('등록 실패')\r\n  }\r\n}\r\n\r\nconst handleReceive = async () => {\r\n  for (const item of selectedRows.value) {\r\n    const id = item.purchase_order_id\r\n    const inputQty = Number(item.receive_qty || 0)\r\n\r\n    const res1 = await axios.put(`/receiveQty/${id}`, {\r\n      receive_qty: inputQty,\r\n    })\r\n\r\n    if (!res1.data.isUpdated) {\r\n      alert(`[${id}] 수령 수량 업데이트 실패`)\r\n      continue\r\n    }\r\n\r\n    const res2 = await axios.get(`/orderCheck/${id}`)\r\n    const order = res2.data[0]\r\n    console.log(order.received_quantity);\r\n    console.log(order.purchase_order_quantity);\r\n    console.log(`${id}`);\r\n\r\n    if (order.received_quantity === order.purchase_order_quantity) {\r\n      const now = new Date()\r\n      const yyyyMMdd = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`\r\n      const random = Math.floor(100 + Math.random() * 900)\r\n      const materialQualNum = `QUN-${yyyyMMdd}-${random}`\r\n      \r\n\r\n      await axios.put(`/orderCheck/${id}`)\r\n      await axios.post('/qualityTest', {\r\n        material_qual_num: materialQualNum,\r\n        purchase_order_id: id,\r\n        material_code: order.material_code,\r\n      })\r\n\r\n      alert(`[${id}] 수령 및 품질검사 등록 완료!`)\r\n    } else {\r\n      alert(`[${id}] 수령 완료! (누적 수령 중)`)\r\n    }\r\n  }\r\n\r\n  selectedRows.value = []\r\n  await fetchOrder()\r\n}\r\n\r\nonMounted(() => {\r\n  fetchMaterialsOrder()\r\n  fetchOrder()\r\n})\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.receipt-page {\r\n  padding: 1.5rem;\r\n  max-width: 1000px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.page-title {\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.table-section {\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.table-title {\r\n  font-size: 1.2rem;\r\n  font-weight: 600;\r\n  margin-bottom: 1rem;\r\n}\r\n</style>\r\n"],"names":["formatToKST","isoDate","date","kst","toDateOnly","iso","generateLotNumber","materialCode","now","yyyyMMdd","random","materialOrderList","ref","orderCheckList","orderPage","receiptPage","selectedRows","orderColumns","receiptColumns","fetchMaterialsOrder","res","axios","fetchOrder","saveMaterialLot","item","payload","res2","handleReceive","id","inputQty","order","materialQualNum","onMounted","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","_hoisted_2","_createVNode","_component_va_data_table","_withCtx","row","_createTextVNode","_toDisplayString","_component_va_input","$event","_component_va_checkbox","r","checked","index","_component_va_button","_hoisted_3"],"mappings":"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"}