import{d as C,n as p,c as g,o as Q,v as i,x as q,p as y,i as a,j as n,g as f,e as I,q as R,F as U,y as L,w as B,h as m,t as b,m as M,_ as F}from"./index-DTBJ0DMA.js";const S={class:"product-form"},D={class:"form-section"},T={class:"input-row"},j={class:"input-row"},E={class:"input-row"},P={class:"form-section"},$={class:"custom-table"},z={class:"form-buttons"},A=C({__name:"QualityListPage",setup(G){const t=p({productCode:"",workOrderNo:"",qualRemark:""}),d=p([]),V=g(()=>d.value.some(l=>l.insp_result!=="합")?"불합":"합"),c=g(()=>d.value.some(l=>l.insp_measured_value!==void 0&&l.insp_measured_value!==null&&l.insp_result==="불합")),k=p([]),v=p([]);Q(async()=>{try{const l=await i.get("/qualitys/productList");k.value=l.data.map(e=>({label:e.product_name,value:e.product_code}))}catch(l){console.error("제품명 목록 조회 실패:",l)}});const N=async l=>{if(console.log("제품 선택:",l),t.value.workOrderNo="",v.value=[],!!l)try{const e=await i.get("/qualitys/workOrderNoList",{params:{productCode:l}});v.value=e.data.map(u=>({label:u.work_order_no,value:u.work_order_no}))}catch(e){console.error("작업지시서 목록 조회 실패:",e)}},r=p({processName:"",managerId:"",passQty:0});q(()=>t.value.workOrderNo,async l=>{if(!l){r.value={processName:"",managerId:"",passQty:0};return}try{const e=await i.get("/qualitys/workOrderDetail",{params:{workOrderNo:l}});if(e.data.length>0){const u=e.data[0];r.value={processName:u.process_name||"",managerId:u.manager_id||"",passQty:u.pass_qty||0}}else r.value={processName:"",managerId:"",passQty:0}}catch(e){console.error("작업지시서 상세 조회 실패:",e)}}),q(()=>r.value.processName,async l=>{if(!l){d.value=[];return}try{const e=await i.get("/qualitys/inspectionStandard",{params:{processName:l}});console.log("검사 기준 응답:",e.data),d.value=e.data}catch(e){console.error("검사 기준 조회 실패:",e),d.value=[]}});const h=l=>{const e=l.insp_measured_value;if(e==null||e===""){l.insp_result="판정대기";return}const u=l.insp_value_min,s=l.insp_value_max;e>=u&&e<=s?l.insp_result="합":l.insp_result="불합"},O=async()=>{if(!t.value.productCode||!t.value.workOrderNo){alert("제품명과 작업지시서 번호를 선택하세요.");return}const l=d.value.map(s=>s.insp_measured_value).filter(s=>s!=null),e=l.length>0?l.reduce((s,_)=>s+_,0)/l.length:null;if(e===null){alert("측정값을 입력해주세요.");return}if(c.value&&!t.value.qualRemark){alert("불합 사유를 입력해주세요.");return}const u=V.value==="불합"?r.value.passQty:0;try{(await i.post("/qualitys/registerTest",{productCode:t.value.productCode,workOrderNo:t.value.workOrderNo,qual_measured_value:e,qual_result:V.value,process_name:r.value.processName,pass_qty:r.value.passQty,insp_value_qty:u,qual_remark:c.value?t.value.qualRemark:null})).data.success?(alert("검사 결과 등록 완료"),t.value.qualRemark=""):alert("등록 실패")}catch(s){console.error("등록 오류:",s),alert("서버 오류로 등록 실패")}};return(l,e)=>{const u=f("va-select"),s=f("va-input"),_=f("va-button");return m(),y("div",S,[e[10]||(e[10]=a("h3",{class:"form-title"},"제품품질검사",-1)),e[11]||(e[11]=a("br",null,null,-1)),a("div",D,[e[6]||(e[6]=a("h3",{class:"form-title"},"조회",-1)),e[7]||(e[7]=a("br",null,null,-1)),a("div",T,[n(u,{modelValue:t.value.productCode,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.value.productCode=o),N],options:k.value,label:"제품명",class:"quarter-width","value-by":"value","text-by":"label",placeholder:"제품을 선택하세요"},null,8,["modelValue","options"]),n(u,{modelValue:t.value.workOrderNo,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.workOrderNo=o),options:v.value,label:"작업지시서 번호",class:"quarter-width","value-by":"value","text-by":"label",placeholder:"작업지시서 번호를 선택하세요",disabled:v.value.length===0},null,8,["modelValue","options","disabled"])]),a("div",j,[n(s,{modelValue:r.value.processName,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.processName=o),label:"공정명",readonly:""},null,8,["modelValue"]),n(s,{modelValue:r.value.managerId,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.managerId=o),label:"담당자",readonly:""},null,8,["modelValue"]),n(s,{modelValue:r.value.passQty,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.passQty=o),label:"투입량",readonly:""},null,8,["modelValue"])]),a("div",E,[c.value?(m(),I(s,{key:0,modelValue:t.value.qualRemark,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.qualRemark=o),label:"불합 판정 상세 사유",placeholder:"불합 사유를 입력하세요",class:"half-width",rules:[o=>!!o||"불합 사유는 필수입니다."]},null,8,["modelValue","rules"])):R("",!0)])]),a("div",P,[a("table",$,[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"판정방식"),a("th",null,"단위"),a("th",null,"기준값"),a("th",null,"측정값"),a("th",null,"판정결과")])],-1)),a("tbody",null,[(m(!0),y(U,null,L(d.value,(o,x)=>(m(),y("tr",{key:x},[a("td",null,b(o.insp_value_type),1),a("td",null,b(o.insp_unit),1),a("td",null,b(o.insp_value_qty),1),a("td",null,[n(s,{modelValue:o.insp_measured_value,"onUpdate:modelValue":w=>o.insp_measured_value=w,modelModifiers:{number:!0},onInput:w=>h(o),type:"number",placeholder:"측정값 입력"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",null,[n(s,{"model-value":o.insp_result||"판정대기",readonly:"",color:"primary"},null,8,["model-value"])])]))),128))])]),a("div",z,[n(_,{onClick:O,color:"primary"},{default:B(()=>e[9]||(e[9]=[M("등록")])),_:1,__:[9]})])])])}}}),J=F(A,[["__scopeId","data-v-39e7aae0"]]);export{J as default};
//# sourceMappingURL=QualityListPage-D3bBD8gJ.js.map
