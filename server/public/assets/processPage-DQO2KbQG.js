import{d as B,n as b,c as N,f as u,p,i as e,D as g,E as V,F as M,y as U,G as E,t as y,q,_ as I,H as O,g as G,x,o as ne,v as h}from"./index-O14FyZ-J.js";const re={key:0,class:"popup-overlay"},ce={class:"popup-content"},de={class:"popup-header"},ue={class:"material-table"},ie=["value"],pe={class:"popup-footer"},_e=B({__name:"MaterialAddPopup",props:{visible:{type:Boolean},materials:{}},emits:["update:visible","add"],setup(w,{emit:_}){const $=w,i=_,C=b(""),d=b([]),l=N(()=>{const v=C.value.trim().toLowerCase();return v?$.materials.filter(n=>n.material_code.toLowerCase().includes(v)||n.material_name.toLowerCase().includes(v)):$.materials});function r(){const v=$.materials.filter(n=>d.value.includes(n.material_code));i("add",v),i("update:visible",!1)}return(v,n)=>v.visible?(u(),p("div",re,[e("div",ce,[e("div",de,[n[3]||(n[3]=e("h3",null,"ìžìž¬ ì„ íƒ",-1)),g(e("input",{"onUpdate:modelValue":n[0]||(n[0]=f=>C.value=f),placeholder:"ìžìž¬ì½”ë“œ ë˜ëŠ” ìžìž¬ëª… ê²€ìƒ‰",class:"search-input"},null,512),[[V,C.value]])]),e("table",ue,[n[4]||(n[4]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ìžìž¬ì½”ë“œ"),e("th",null,"ìžìž¬ëª…"),e("th",null,"ë¶„ë¥˜"),e("th",null,"ë‹¨ìœ„"),e("th",null,"ê·œê²©")])],-1)),e("tbody",null,[(u(!0),p(M,null,U(l.value,f=>(u(),p("tr",{key:f.material_code},[e("td",null,[g(e("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=m=>d.value=m),value:f.material_code},null,8,ie),[[E,d.value]])]),e("td",null,y(f.material_code),1),e("td",null,y(f.material_name),1),e("td",null,y(f.material_cls),1),e("td",null,y(f.material_unit),1),e("td",null,y(f.material_stand),1)]))),128))])]),e("div",pe,[e("button",{class:"btn save",onClick:r},"ì¶”ê°€"),e("button",{class:"btn",onClick:n[2]||(n[2]=f=>v.$emit("update:visible",!1))},"ë‹«ê¸°")])])])):q("",!0)}}),ve=I(_e,[["__scopeId","data-v-70bd97e6"]]),me={key:0,class:"popup-overlay"},be={class:"popup-content wide"},fe={class:"popup-header"},he={class:"material-table"},ye=["onUpdate:modelValue"],ge=["onUpdate:modelValue","onChange"],$e=["value"],Ce=["onUpdate:modelValue"],ke={class:"popup-footer"},Pe=B({__name:"PopupDetail",props:{visible:{type:Boolean},processCode:{},productCode:{},materialOptions:{},materialList:{},bomCode:{}},emits:["update:visible","save","materialCodeChange","addMaterial","deleteSelectedMaterials"],setup(w,{emit:_}){const $=w,i=b(!1);function C(d){for(const l of d)$.materialList.push({process_code:$.processCode,material_code:l.material_code,material_name:l.material_name,material_unit:l.material_unit,BOM_code:$.bomCode,usage_qty:l.usage_qty??0,responsible:"",selected:!1})}return(d,l)=>d.visible?(u(),p("div",me,[e("div",be,[e("div",fe,[e("div",null,[e("button",{class:"btn add",onClick:l[0]||(l[0]=r=>i.value=!0)},"ìž¬ë£Œì¶”ê°€"),e("button",{class:"btn delete",onClick:l[1]||(l[1]=r=>d.$emit("deleteSelectedMaterials"))},"ìž¬ë£Œì‚­ì œ")])]),e("table",he,[l[6]||(l[6]=e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",disabled:""})]),e("th",null,"ìžìž¬ì½”ë“œ"),e("th",null,"ìžìž¬ëª…"),e("th",null,"ë‹¨ìœ„"),e("th",null,"íˆ¬ìž…ëŸ‰"),e("th",null,"ë‹´ë‹¹ìž")])],-1)),e("tbody",null,[(u(!0),p(M,null,U(d.materialList,(r,v)=>(u(),p("tr",{key:v},[e("td",null,[g(e("input",{type:"checkbox","onUpdate:modelValue":n=>r.selected=n},null,8,ye),[[E,r.selected]])]),e("td",null,[g(e("select",{"onUpdate:modelValue":n=>r.material_code=n,onChange:n=>d.$emit("materialCodeChange",r)},[l[5]||(l[5]=e("option",{disabled:"",value:""},"ìžìž¬ ì„ íƒ",-1)),(u(!0),p(M,null,U(d.materialOptions,n=>(u(),p("option",{key:n.material_code,value:n.material_code},y(n.material_code),9,$e))),128))],40,ge),[[O,r.material_code]])]),e("td",null,y(r.material_name),1),e("td",null,y(r.material_unit),1),e("td",null,y(r.usage_qty),1),e("td",null,[g(e("input",{type:"text","onUpdate:modelValue":n=>r.responsible=n},null,8,Ce),[[V,r.responsible]])])]))),128))])]),e("div",ke,[e("button",{class:"btn save",onClick:l[2]||(l[2]=r=>d.$emit("save"))},"ì €ìž¥"),e("button",{class:"btn",onClick:l[3]||(l[3]=r=>d.$emit("update:visible",!1))},"ì·¨ì†Œ")]),i.value?(u(),G(ve,{key:0,visible:i.value,materials:d.materialOptions,"onUpdate:visible":l[4]||(l[4]=r=>i.value=r),onAdd:C},null,8,["visible","materials"])):q("",!0)])])):q("",!0)}}),Ve=I(Pe,[["__scopeId","data-v-1ddfe2aa"]]),Me={class:"process-page"},Ue={class:"product-search va-row va-gap-2 va-items-center"},we={class:"times"},Se={class:"product-label"},Le={class:"process-table"},qe=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Oe=["onUpdate:modelValue"],Be=["value"],Ee=["onUpdate:modelValue"],Ie=["value"],Ae={key:1,style:{color:"red"}},Re=["onClick"],Te=B({__name:"processPage",setup(w){const _=b(""),$=b([]),i=b([]),C=b([]),d=b(!1),l=b(""),r=b([]),v=b([]),n=b(""),f=b(""),m=b({product_code:"",product_name:"",product_stand:""}),F=()=>{let t=null;if(m.value.product_code&&(t=$.value.find(c=>c.product_code===m.value.product_code)??null),!t&&m.value.product_name&&m.value.product_stand&&(t=$.value.find(c=>c.product_name===m.value.product_name&&c.product_stand===m.value.product_stand)??null),!t){alert("í•´ë‹¹ ì œí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const s=i.value.length>0,o=_.value&&_.value!==t.product_code;s&&o&&!confirm(`í˜„ìž¬ ê³µì • ì •ë³´ë¥¼ ìž‘ì„± ì¤‘ìž…ë‹ˆë‹¤.
ì œí’ˆì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)||(_.value=t.product_code)},H=()=>{m.value={product_code:"",product_name:"",product_stand:""},_.value="",i.value=[]},S=b([]),j=async()=>{try{const t=await h.get("/processInit");S.value=t.data}catch(t){console.error("âŒ ê³µì • ê¸°ë³¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",t)}},z=async()=>{try{const t=await h.get("/product");$.value=t.data}catch(t){console.log("âŒ ì œí’ˆ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",t)}},J=async()=>{try{const t=await h.get("/common-codes/?groups=0T");C.value=t.data["0T"]||[]}catch(t){console.error("âŒ ì„¤ë¹„ìœ í˜• ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",t)}},A=async()=>{try{const t=await h.get(`/bom/processList/${n.value}`);v.value=t.data,f.value=t.data[0].bom_code,console.log("ìžìž¬:",t.data)}catch(t){console.log("âŒ ìžìž¬ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",t)}},D=async()=>{try{const s=(await h.get(`/process/${_.value}`)).data;i.value=s.map(o=>{const c=S.value.find(a=>a.process_name===o.process_name);return{process_code:o.process_code,process_time:o.process_time,process_name:o.process_name,code_value:o.code_value,process_int:(c==null?void 0:c.process_int)||"",selected:!1}})}catch(t){console.log("âŒ ê³µì •ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",t)}},R=async()=>{try{const s=(await h.get(`/processDetail/${l.value}`)).data;r.value=s.map(o=>{const c=v.value.find(a=>a.material_code===o.material_code);return{process_code:o.process_code||l.value,material_code:o.material_code,BOM_code:o.BOM_code||"",usage_qty:o.usage_qty,responsible:o.name,material_name:(c==null?void 0:c.material_name)||"",material_unit:(c==null?void 0:c.material_unit)||"",selected:!1}})}catch(t){console.log("âŒ ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",t)}};x(l,t=>{t&&R()}),x(_,t=>{t&&D()});const K=t=>{const s=v.value.find(o=>o.material_code===t.material_code);s&&(t.material_name=s.material_name,t.material_unit=s.material_unit,t.usage_qty=s.usage_qty)},Q=N(()=>i.value.reduce((t,s)=>{const o=parseInt(s.process_time.replace(/[^\d]/g,""));return t+(isNaN(o)?0:o)},0)),W=()=>{i.value.push({process_code:"",process_time:"",process_name:"",code_value:"",process_int:"",selected:!1})},X=async()=>{for(const t of i.value)if(t.selected&&t.process_code)try{await h.delete(`/process/${t.process_code}`),console.log(`ðŸ—‘ï¸ ì„œë²„ì—ì„œ ê³µì • ì‚­ì œ ì™„ë£Œ: ${t.process_code}`)}catch(s){console.error(`âŒ ê³µì • ì‚­ì œ ì‹¤íŒ¨: ${t.process_code}`,s),alert(`ê³µì • ${t.process_code} ì‚­ì œ ì‹¤íŒ¨!`)}i.value=i.value.filter(t=>!t.selected)},Y=()=>{r.value.push({process_code:"",material_code:"",material_name:"",material_unit:"",BOM_code:"",usage_qty:0,responsible:"",selected:!1})},Z=async()=>{for(const t of r.value)if(console.log("âœ… ì‚­ì œ í›„ë³´:",t),t.selected&&t.process_code&&t.material_code)try{await h.delete(`/processDetail/${t.process_code}/${t.material_code}`)}catch{}r.value=r.value.filter(t=>!t.selected)},ee=async()=>{try{await h.delete(`/processDetail/${l.value}`),console.log(`âœ… ${l.value} ì— í•´ë‹¹í•˜ëŠ” ê¸°ì¡´ ìžìž¬ ì‚­ì œ ì™„ë£Œ`)}catch(s){console.error("âŒ ê¸°ì¡´ ìžìž¬ ì‚­ì œ ì‹¤íŒ¨:",s),alert("ê¸°ì¡´ ìžìž¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!");return}const t=r.value.map(s=>({process_code:l.value,material_code:s.material_code,BOM_code:f.value,name:s.responsible}));console.log("ðŸ“¦ ì €ìž¥í•  ìž¬ë£Œ ë°ì´í„°:",t);try{(await h.post(`/process/${l.value}`,t)).data.isSuccessed===!0?(alert("ëª¨ë“  ìž¬ë£Œ ë“±ë¡ ì™„ë£Œ!"),await R()):alert("ë“±ë¡ ì‹¤íŒ¨!")}catch(s){console.error("âŒ ìžìž¬ ë“±ë¡ ì‹¤íŒ¨:",s),alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ!")}},te=async()=>{const t=[],s=[],o=`${_.value}-Process`,c={process_group_code:o,product_code:_.value};i.value.forEach((a,L)=>{const k=`${_.value}Process${L+1}`,P=S.value.find(ae=>ae.process_int===a.process_int),le=(P==null?void 0:P.process_name)||"",T={process_code:k,process_name:le,process_time:a.process_time,process_seq:L+1,code_value:a.code_value,product_code:_.value,process_group_code:o,process_int:a.process_int};a.process_code?s.push(T):t.push(T)});try{const a=await h.get(`/processG/${o}`),L=Array.isArray(a.data)&&a.data.length>0;if(t.length>0){if(!L&&!(await h.post("/processG",c)).data.isSuccessed)throw new Error("ê³µì • ê·¸ë£¹ ë“±ë¡ ì‹¤íŒ¨");if(!(await h.post("/process",t)).data.isSuccessed)throw new Error("ê³µì • ë“±ë¡ ì‹¤íŒ¨")}for(const k of s)try{(await h.put(`/process/${k.process_code}`,[k])).data.isSuccessed||console.warn(`âš ï¸ ìˆ˜ì • ì‹¤íŒ¨: ${k.process_code}`)}catch(P){console.error(`âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ${k.process_code}`,P),alert(`ê³µì • ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${k.process_code}`)}alert("ê³µì • ì €ìž¥ ì™„ë£Œ!"),await D()}catch(a){console.error("âŒ ì €ìž¥ ì‹¤íŒ¨:",a),alert("ì €ìž¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!")}},se=(t,s)=>{l.value=t,n.value=s,d.value=!0,A()},oe=(t,s)=>{if(!t){alert("ê³µì •ì„ ë¨¼ì € ì €ìž¥í•´ì•¼ ìƒì„¸ì •ë³´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.");return}const o=`${_.value}Process${s+1}`;se(o,_.value)};return ne(()=>{z(),J(),A(),D(),j()}),(t,s)=>(u(),p("div",Me,[s[11]||(s[11]=e("h2",{class:"title"},"ê³µì • íë¦„ë„ ê´€ë¦¬",-1)),e("div",Ue,[s[4]||(s[4]=e("label",null,"ì œí’ˆì½”ë“œ: ",-1)),g(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>m.value.product_code=o),placeholder:"ì œí’ˆì½”ë“œ ìž…ë ¥"},null,512),[[V,m.value.product_code]]),s[5]||(s[5]=e("label",null,"ì œí’ˆëª…: ",-1)),g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>m.value.product_name=o),placeholder:"ì œí’ˆëª… ìž…ë ¥"},null,512),[[V,m.value.product_name]]),s[6]||(s[6]=e("label",null,"ê·œê²©:",-1)),g(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>m.value.product_stand=o),placeholder:"ê·œê²© ìž…ë ¥"},null,512),[[V,m.value.product_stand]]),e("button",{class:"btn search",onClick:F},"ê²€ìƒ‰"),e("button",{class:"btn reset",onClick:H},"ì´ˆê¸°í™”"),e("button",{class:"btn save",onClick:te},"ì €ìž¥")]),e("div",we,[e("span",Se,"ì´ ì†Œìš”ì‹œê°„: "+y(Q.value)+"ë¶„",1)]),e("div",Le,[e("div",{class:"table-header"},[s[7]||(s[7]=e("h3",null,"ê³µì •ìˆœì„œ",-1)),e("div",null,[e("button",{class:"btn add",onClick:W},"ê³µì •ì¶”ê°€"),e("button",{class:"btn delete",onClick:X},"ê³µì •ì‚­ì œ")])]),e("table",null,[s[10]||(s[10]=e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",disabled:""})]),e("th",null,"ìˆœë²ˆ"),e("th",null,"ì˜ˆìƒì†Œìš”ì‹œê°„"),e("th",null,"ì‹œí—˜ìž‘ì—…"),e("th",null,"ì„¤ë¹„ìœ í˜•"),e("th",null,"ìƒì„¸ì¶”ê°€")])],-1)),e("tbody",null,[(u(!0),p(M,null,U(i.value,(o,c)=>(u(),p("tr",{key:c},[e("td",null,[g(e("input",{type:"checkbox","onUpdate:modelValue":a=>o.selected=a},null,8,qe),[[E,o.selected]])]),e("td",null,y(c+1),1),e("td",null,[g(e("input",{class:"time-input","onUpdate:modelValue":a=>o.process_time=a,placeholder:"ì˜ˆ: 60ë¶„"},null,8,De),[[V,o.process_time]])]),e("td",null,[g(e("select",{class:"name-input","onUpdate:modelValue":a=>o.process_int=a},[s[8]||(s[8]=e("option",{disabled:"",value:""},"ê³µì • ëª…",-1)),(u(!0),p(M,null,U(S.value,a=>(u(),p("option",{key:a.process_int,value:a.process_int},y(a.process_name),9,Be))),128))],8,Oe),[[O,o.process_int]])]),e("td",null,[C.value.length?g((u(),p("select",{key:0,class:"equipment-select","onUpdate:modelValue":a=>o.code_value=a},[s[9]||(s[9]=e("option",{disabled:"",value:""},"ì„ íƒ",-1)),(u(!0),p(M,null,U(C.value,a=>(u(),p("option",{key:a.value,value:a.value},y(a.label),9,Ie))),128))],8,Ee)),[[O,o.code_value]]):(u(),p("span",Ae,"ðŸš« ì„¤ë¹„ ì½”ë“œ ì—†ìŒ"))]),e("td",null,[e("button",{class:"btn save",onClick:a=>oe(o.process_code,c)}," ìƒì„¸ì¶”ê°€ ",8,Re)])]))),128))])])]),d.value?(u(),G(Ve,{key:0,visible:d.value,processCode:l.value,productCode:n.value,materialOptions:v.value,materialList:r.value,bomCode:f.value,"onUpdate:visible":s[3]||(s[3]=o=>d.value=o),onSave:ee,onMaterialCodeChange:K,onAddMaterial:Y,onDeleteSelectedMaterials:Z},null,8,["visible","processCode","productCode","materialOptions","materialList","bomCode"])):q("",!0)]))}}),Ne=I(Te,[["__scopeId","data-v-2577aa66"]]);export{Ne as default};
//# sourceMappingURL=processPage-DQO2KbQG.js.map
