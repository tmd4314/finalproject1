import{_ as J,n as p,c as b,o as Q,p as d,i as t,D as i,H as k,F as m,y,E as h,l as R,t as s,v as x,f as l,G as V}from"./index-KTdWOH4t.js";const W={class:"max-w-[1060px] h-[739px] mx-auto p-4 bg-gray-50 overflow-hidden"},X={class:"grid grid-cols-2 gap-4 h-[calc(100%-80px)]"},Z={class:"flex flex-col bg-white rounded-lg shadow-sm border border-gray-200 p-4"},ee={class:"mb-4"},te=["value"],oe={class:"h-[550px] overflow-auto border border-gray-200 rounded"},re={class:"w-full text-sm border-collapse bg-white"},ae=["onClick"],se={class:"border border-gray-200 px-3 py-2 text-xs"},de={class:"border border-gray-200 px-3 py-2 text-xs"},le={class:"border border-gray-200 px-3 py-2 text-xs"},ne={class:"border border-gray-200 px-3 py-2 text-xs"},ue={class:"flex flex-col bg-white rounded-lg shadow-sm border border-gray-200 p-4"},ce={class:"grid grid-cols-3 gap-3 mb-4"},ie={class:"relative"},pe=["value"],be=["disabled"],_e=["value"],me={class:"mb-3 flex flex-col h-60"},ye={class:"flex justify-between items-center mb-2"},xe=["disabled"],ge={class:"flex-1 overflow-auto border border-gray-200 rounded"},ve={class:"w-full text-xs border-collapse bg-white"},fe={class:"border border-gray-200 px-2 py-0.5 text-center"},he=["onUpdate:modelValue"],we={class:"border border-gray-200 px-2 py-0.5"},Me={class:"border border-gray-200 px-2 py-0.5"},ke={class:"border border-gray-200 px-2 py-0.5"},Be={class:"border border-gray-200 px-2 py-0.5"},Ce={class:"border border-gray-200 px-2 py-0.5"},Oe=["onUpdate:modelValue"],Se={class:"border border-gray-200 px-2 py-0.5"},Ve={class:"mb-3"},Le={class:"flex gap-2 mb-2"},Pe={class:"h-[200px] overflow-y-auto border border-gray-200 rounded"},Ue={class:"w-full text-xs border-collapse bg-white"},qe={class:"border border-gray-200 px-2 py-0.5 text-center"},Ee=["value"],De={class:"border border-gray-200 px-2 py-0.5"},$e={class:"border border-gray-200 px-2 py-0.5"},Ae={class:"border border-gray-200 px-2 py-0.5"},Fe={class:"border border-gray-200 px-2 py-0.5"},Ne={class:"border border-gray-200 px-2 py-0.5"},Te={class:"flex gap-3 justify-center mt-2"},je=["disabled"],Ke={__name:"BomManager",setup(Ge){const B=p([]),_=p([]),w=p([]),v=p(""),g=p([]),f=p(""),c=p(!1),a=p({bom_code:"",product_code:"",product_name:"",product_stand:"",materials:[],deletedMaterials:[]}),M=b(()=>{const r=new Map;return B.value.forEach(e=>{r.has(e.bom_code)||r.set(e.bom_code,{bom_code:e.bom_code,product_code:e.product_code,product_name:e.product_name,product_stand:e.product_stand})}),Array.from(r.values())}),L=b(()=>{const r=new Map;return _.value.forEach(e=>{const o=e.product_code.replace(/-\d+$/,"");r.has(o)||r.set(o,{base_product_code:o,product_name:e.product_name,variants:[]}),r.get(o).variants.push({product_code:e.product_code,product_stand:e.product_stand})}),Array.from(r.values())}),P=b(()=>{const r=new Set;return _.value.forEach(e=>{e.product_name&&r.add(e.product_name)}),Array.from(r).sort()}),U=b(()=>{if(!a.value.product_name)return[];const r=new Set;return _.value.filter(e=>e.product_name===a.value.product_name).forEach(e=>{e.product_stand&&r.add(e.product_stand)}),Array.from(r).sort()}),q=b(()=>{if(!v.value)return M.value;const r=_.value.filter(e=>e.product_name===v.value).map(e=>e.product_code);return M.value.filter(e=>r.includes(e.product_code))}),E=b(()=>{if(!f.value)return w.value.slice(0,50);const r=f.value.toLowerCase();return w.value.filter(e=>e.material_code.toLowerCase().includes(r)||e.material_name.toLowerCase().includes(r)).slice(0,50)}),D=b(()=>a.value.materials.some(r=>r.selected)),C=b(()=>a.value.bom_code&&a.value.product_name&&a.value.product_stand&&a.value.materials.length>0),$=()=>{if(a.value.product_code){const r=new Date,e=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),u=String(r.getDate()).padStart(2,"0"),n=e+o+u;a.value.bom_code=`BOM-${a.value.product_code}-${n}`}},A=()=>{a.value.product_stand="",a.value.product_code="",a.value.bom_code=""},F=async()=>{if(!c.value&&a.value.product_name&&a.value.product_stand){const r=_.value.find(e=>e.product_name===a.value.product_name&&e.product_stand===a.value.product_stand);r?(a.value.product_code=r.product_code,$(),await N(r.product_code)):(a.value.product_code="",a.value.bom_code="")}},N=async r=>{try{return M.value.find(o=>o.product_code===r)?(alert(`${a.value.product_name}의 BOM 코드가 이미 등록되어 있습니다.`),a.value.bom_code="",!1):!0}catch{return!0}},T=()=>{},j=async r=>{if(!(c.value&&a.value.bom_code===r.bom_code))try{const e=await x.get(`/bom/${r.bom_code}`);if(e.data&&e.data.master){const{master:o,materials:u}=e.data;a.value={bom_code:o.bom_code,product_code:o.product_code,product_name:o.product_name,product_stand:o.product_stand,materials:u.map(n=>({material_code:n.material_code,material_name:n.material_name,material_type:n.material_type||"",material_unit:n.material_unit,material_stand:n.material_stand,usage_qty:n.usage_qty,bom_unit:n.bom_unit,selected:!1,status:"existing"})),deletedMaterials:[]},c.value=!0}}catch{alert("BOM 상세 정보를 불러오는데 실패했습니다.")}},K=()=>{g.value.forEach(r=>{a.value.materials.find(e=>e.material_code===r.material_code)||a.value.materials.push({material_code:r.material_code,material_name:r.material_name,material_type:r.material_type||r.material_category||"",material_unit:r.material_unit,material_stand:r.material_stand,usage_qty:0,bom_unit:r.material_unit,selected:!1,status:"new"})}),g.value=[]},G=()=>{const r=a.value.materials.filter(o=>o.selected);if(r.length===0){alert("삭제할 자재를 선택해주세요.");return}const e=r.filter(o=>o.status==="existing");e.length>0&&(a.value.deletedMaterials=a.value.deletedMaterials||[],e.forEach(o=>{a.value.deletedMaterials.push({material_code:o.material_code,bom_code:a.value.bom_code})})),a.value.materials=a.value.materials.filter(o=>!o.selected)},H=async()=>{if(!C.value){alert("BOM 코드, 제품명, 규격, 자재를 모두 입력해주세요.");return}try{let r=a.value.product_code;if(!c.value&&!r){const o=_.value.find(u=>u.product_name===a.value.product_name&&u.product_stand===a.value.product_stand);if(o)r=o.product_code;else{alert("선택한 제품명과 규격에 해당하는 제품을 찾을 수 없습니다.");return}}const e={master:{bom_code:a.value.bom_code,product_code:r,product_name:a.value.product_name,product_stand:a.value.product_stand},materials:a.value.materials.map(o=>({material_code:o.material_code,usage_qty:o.usage_qty,bom_unit:o.bom_unit||o.material_unit,status:o.status||"new"}))};c.value?(await x.put("/bom",e),alert("BOM 수정 완료")):(await x.post("/bom",e),alert("BOM 등록 완료")),await S(),O()}catch(r){r.response&&r.response.data&&r.response.data.error?alert(`BOM 저장에 실패했습니다: ${r.response.data.error}`):alert("BOM 저장에 실패했습니다.")}},O=()=>{a.value={bom_code:"",product_code:"",product_name:"",product_stand:"",materials:[],deletedMaterials:[]},c.value=!1,g.value=[]},S=async()=>{try{const r=await x.get("/bom/list");B.value=r.data||[]}catch{}},I=async()=>{try{const r=await x.get("/bom/products");_.value=r.data||[]}catch{}},Y=async()=>{try{const r=await x.get("/bom/materials");w.value=r.data||[]}catch{}},z=()=>{};return Q(()=>{S(),I(),Y()}),(r,e)=>(l(),d("div",W,[e[19]||(e[19]=t("div",{class:"mb-4"},[t("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"BOM 관리")],-1)),t("div",X,[t("div",Z,[t("div",ee,[e[8]||(e[8]=t("label",{class:"block text-xs font-medium text-blue-600 mb-2"},"제품명",-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),onChange:T,class:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"},[e[7]||(e[7]=t("option",{value:""},"제품명 선택",-1)),(l(!0),d(m,null,y(L.value,o=>(l(),d("option",{key:o.base_product_code,value:o.product_name},s(o.product_name),9,te))),128))],544),[[k,v.value]])]),t("div",oe,[t("table",re,[e[9]||(e[9]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700 text-xs"},"BOM코드"),t("th",{class:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700 text-xs"},"제품코드"),t("th",{class:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700 text-xs"},"제품명"),t("th",{class:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700 text-xs"},"규격")])],-1)),t("tbody",null,[(l(!0),d(m,null,y(q.value,o=>(l(),d("tr",{key:o.bom_code,onClick:u=>j(o),class:"hover:bg-blue-50 cursor-pointer transition-colors duration-150"},[t("td",se,s(o.bom_code),1),t("td",de,s(o.product_code),1),t("td",le,s(o.product_name),1),t("td",ne,s(o.product_stand),1)],8,ae))),128))])])])]),t("div",ue,[t("div",ce,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs font-medium text-blue-600 mb-2"},"BOM 코드",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.bom_code=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-xs bg-gray-100",readonly:""},null,512),[[h,a.value.bom_code]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs font-medium text-blue-600 mb-2"},"제품명",-1)),t("div",ie,[c.value?i((l(),d("input",{key:1,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.product_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md bg-gray-100 text-gray-600 text-xs",readonly:""},null,512)),[[h,a.value.product_name]]):i((l(),d("select",{key:0,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.product_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs",onChange:A},[e[11]||(e[11]=t("option",{value:""},"제품명 선택",-1)),(l(!0),d(m,null,y(P.value,o=>(l(),d("option",{key:o,value:o},s(o),9,pe))),128))],544)),[[k,a.value.product_name]])])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-medium text-blue-600 mb-2"},"규격",-1)),i(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.product_stand=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs",onChange:F,disabled:!a.value.product_name||c.value},[e[13]||(e[13]=t("option",{value:""},"규격 선택",-1)),(l(!0),d(m,null,y(U.value,o=>(l(),d("option",{key:o,value:o},s(o),9,_e))),128))],40,be),[[k,a.value.product_stand]])])]),t("div",me,[t("div",ye,[e[15]||(e[15]=t("label",{class:"text-xs font-medium text-blue-600"},"투입 자재",-1)),t("button",{onClick:G,class:"px-3 py-1.5 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!D.value}," 제거 ",8,xe)]),t("div",ge,[t("table",ve,[e[16]||(e[16]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"border border-gray-200 px-2 py-0.5 text-center font-medium text-gray-700"},"#"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"자재코드"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"자재명"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"분류"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"규격"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"투입량"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"단위")])],-1)),t("tbody",null,[(l(!0),d(m,null,y(a.value.materials,(o,u)=>(l(),d("tr",{key:o.material_code||u,class:"hover:bg-gray-50"},[t("td",fe,[i(t("input",{type:"checkbox","onUpdate:modelValue":n=>o.selected=n,class:"rounded w-3 h-3"},null,8,he),[[V,o.selected]])]),t("td",we,s(o.material_code),1),t("td",Me,s(o.material_name),1),t("td",ke,s(o.material_type||"-"),1),t("td",Be,s(o.material_stand),1),t("td",Ce,[i(t("input",{"onUpdate:modelValue":n=>o.usage_qty=n,type:"number",step:"0.01",class:"w-14 px-1 py-0.5 border border-gray-300 rounded text-xs focus:outline-none focus:ring-1 focus:ring-blue-500"},null,8,Oe),[[h,o.usage_qty,void 0,{number:!0}]])]),t("td",Se,s(o.material_unit),1)]))),128))])])])]),t("div",Ve,[e[18]||(e[18]=t("label",{class:"text-xs font-medium text-blue-600 mb-2 block"},"자재 검색 및 추가",-1)),t("div",Le,[i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>f.value=o),placeholder:"자재코드 또는 자재명",class:"flex-1 px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-xs",onKeyup:R(z,["enter"])},null,544),[[h,f.value]]),t("button",{onClick:K,class:"px-3 py-1.5 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-colors duration-150"}," 추가 ")]),t("div",Pe,[t("table",Ue,[e[17]||(e[17]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"border border-gray-200 px-2 py-0.5 text-center font-medium text-gray-700"},"#"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"자재코드"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"자재명"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"분류"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"규격"),t("th",{class:"border border-gray-200 px-2 py-0.5 text-left font-medium text-gray-700"},"단위")])],-1)),t("tbody",null,[(l(!0),d(m,null,y(E.value,o=>(l(),d("tr",{key:o.material_code,class:"hover:bg-gray-50"},[t("td",qe,[i(t("input",{type:"checkbox",value:o,"onUpdate:modelValue":e[6]||(e[6]=u=>g.value=u),class:"rounded w-3 h-3"},null,8,Ee),[[V,g.value]])]),t("td",De,s(o.material_code),1),t("td",$e,s(o.material_name),1),t("td",Ae,s(o.material_type),1),t("td",Fe,s(o.material_stand),1),t("td",Ne,s(o.material_unit),1)]))),128))])])])]),t("div",Te,[t("button",{onClick:H,class:"px-5 py-1.5 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed font-medium",disabled:!C.value},s(c.value?"수정":"저장"),9,je),t("button",{onClick:O,class:"px-5 py-1.5 bg-gray-500 text-white rounded text-xs hover:bg-gray-600 transition-colors duration-150 font-medium"}," 초기화 ")])])])]))}},Ie=J(Ke,[["__scopeId","data-v-e41ec127"]]);export{Ie as default};
//# sourceMappingURL=BomManager-tw78HCsd.js.map
