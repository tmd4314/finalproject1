import{d as ce,b as ye,n as u,c as U,o as _e,v as D,x as H,e as d,f,p as c,i as l,j as s,w as y,k as g,q as M,F as ge,y as Ve,z as be,h as he,t as m,m as r,_ as we}from"./index-KTdWOH4t.js";const xe={class:"employee-page-container"},Ce={class:"employee-list-panel"},ke={class:"search-filter-area"},Se={class:"search-bar"},Ne={class:"filter-row"},Ue={class:"filter-item"},De={class:"filter-item"},$e={class:"filter-item"},Ie={class:"filter-item"},Ee={class:"filter-item"},Me={key:0,class:"action-buttons"},Oe={key:1,class:"permission-notice"},Pe={class:"table-container"},Fe={class:"employee-table"},Ye={key:0,width:"40"},Le=["onClick"],qe={key:0,class:"no-data"},ze={class:"pagination-area"},Ae={class:"page-info"},Be={class:"page-controls"},Te={key:0,class:"employee-detail-panel"},Re={class:"detail-header"},je={class:"action-buttons"},Ge={class:"detail-form"},He={class:"form-row"},Je={class:"form-group"},Ke={class:"form-row"},Qe={class:"form-group"},We={class:"form-row"},Xe={class:"form-group"},Ze={class:"form-row"},el={class:"form-group"},ll={class:"form-row"},ol={class:"form-group"},tl={class:"form-row"},al={class:"form-group"},sl={class:"form-row"},nl={class:"form-group"},ul={class:"radio-group"},il={class:"form-row"},rl={class:"form-group full-width"},dl={key:1,class:"permission-info-panel"},ml={class:"permission-content"},pl={class:"current-permission"},vl=ce({__name:"EmployeeManagePage",setup(fl){const J=ye(),{canManageAdmin:p,userRole:K}=J,x=u(""),v=u([]),$=u(!1),V=u(1),b=u(10),h=u([]),w=u(null),O=u(!1),n=u({employeeId:"",employeeName:"",department:"",position:"",employmentStatus:""}),a=u({employeeId:"",employeeName:"",departmentCode:"",position:"",hireDate:null,phone:"",email:"",employmentStatus:"Y",remarks:""}),i=u({employeeName:!1,departmentCode:!1,position:!1,hireDate:!1}),Q={"01":"생산","02":"자재","03":"포장","04":"설비","05":"품질","06":"물류","07":"영업"},P=u([]),F=u([]),Y=u([{text:"생산",value:"01"},{text:"자재",value:"02"},{text:"포장",value:"03"},{text:"설비",value:"04"},{text:"품질",value:"05"},{text:"물류",value:"06"},{text:"영업",value:"07"}]),L=u([]),W=u(["사원","주임","대리","과장","차장","부장","이사","상무","전무","대표"]),X=u([{text:"재직",value:"Y"},{text:"퇴직",value:"N"}]),C=U(()=>h.value.filter(o=>{const e=!x.value||o.employee_id.toLowerCase().includes(x.value.toLowerCase())||o.employee_name.toLowerCase().includes(x.value.toLowerCase()),S=(!n.value.employeeId||o.employee_id===n.value.employeeId)&&(!n.value.employeeName||o.employee_name===n.value.employeeName)&&(!n.value.department||o.department_code===n.value.department)&&(!n.value.position||o.position===n.value.position)&&(!n.value.employmentStatus||o.employment_status===n.value.employmentStatus);return e&&S})),Z=U(()=>Math.ceil(C.value.length/b.value)),q=U(()=>(V.value-1)*b.value),z=U(()=>{const o=q.value,e=o+b.value;return C.value.slice(o,e)});_e(async()=>{await I(),ee()});async function I(){try{O.value=!0;const o=await D.get("http://localhost:3000/employee");console.log("사원 데이터:",o.data),h.value=o.data}catch(o){console.error("사원 목록 로드 실패:",o),h.value=[{employee_id:"2024001",employee_name:"홍길동",department_code:"07",position:"과장",hire_date:"2023-05-01",phone:"010-1234-5678",email:"hong@company.com",employment_status:"Y"},{employee_id:"2024002",employee_name:"김철수",department_code:"01",position:"대리",hire_date:"2024-01-15",phone:"010-9876-5432",email:"kim@company.com",employment_status:"Y"}]}finally{O.value=!1}}function ee(){P.value=[...new Set(h.value.map(o=>o.employee_id))],F.value=[...new Set(h.value.map(o=>o.employee_name))],L.value=[...new Set(h.value.map(o=>o.position))]}function le(o){return Q[o]||o}function oe(){V.value=1}function te(o){o?v.value=z.value.map(e=>e.employee_id):v.value=[]}function ae(o){if(!p){console.log("사원 수정 권한이 없습니다.");return}w.value=o,a.value={employeeId:o.employee_id,employeeName:o.employee_name,departmentCode:o.department_code,position:o.position,hireDate:o.hire_date?new Date(o.hire_date):null,phone:o.phone||"",email:o.email||"",employmentStatus:o.employment_status,remarks:o.remarks||""},E()}function A(){w.value=null,a.value={employeeId:"",employeeName:"",departmentCode:"",position:"",hireDate:null,phone:"",email:"",employmentStatus:"Y",remarks:""},E()}function E(){i.value={employeeName:!1,departmentCode:!1,position:!1,hireDate:!1}}function se(){E();let o=!0;return a.value.employeeName.trim()||(i.value.employeeName=!0,o=!1),a.value.departmentCode||(i.value.departmentCode=!0,o=!1),a.value.position||(i.value.position=!0,o=!1),a.value.hireDate||(i.value.hireDate=!0,o=!1),o}async function ne(){if(!p){alert("사원 관리 권한이 없습니다.");return}if(se())try{const o={employee_name:a.value.employeeName,department_code:a.value.departmentCode,position:a.value.position,hire_date:a.value.hireDate?B(a.value.hireDate.toISOString()):null,phone:a.value.phone,email:a.value.email,employment_status:a.value.employmentStatus,remarks:a.value.remarks};console.log("전송할 데이터: ",o),w.value?(await D.put(`http://localhost:3000/employee/${w.value.employee_id}`,o),alert("사원 정보가 수정되었습니다.")):(await D.post("http://localhost:3000/employee",o),alert("사원이 등록되었습니다.")),await I(),A()}catch(o){console.error("사원 저장 실패:",o),alert("사원 저장에 실패했습니다.")}}async function ue(){if(!p){alert("사원 관리 권한이 없습니다.");return}if(console.log("삭제할 사원들: ",v.value),v.value.length!==0&&confirm(`선택한 ${v.value.length}명의 사원을 삭제하시겠습니까?`))try{console.log("다중 삭제 요청 시작");const o=await D.post("http://localhost:3000/employee/delete-multiple",{ids:v.value});console.log("삭제 응답:",o.data),o.data.success?alert(`${o.data.deletedCount}명의 사원이 삭제되었습니다.`):o.data.failedCount>0?alert(`${o.data.deletedCount}명 삭제 완료, ${o.data.failedCount}명 삭제 실패
${o.data.message}`):alert("삭제에 실패했습니다."),await I(),v.value=[],$.value=!1}catch(o){console.error("사원 삭제 실패:",o),alert("사원 삭제에 실패했습니다.")}}function ie(){console.log("엑셀 내보내기"),alert("엑셀 내보내기 기능은 준비 중입니다.")}function re(o){const e=o.replace(/[^0-9]/g,"");e.length==11?a.value.phone=`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`:e.length==9?a.value.phone=`${e.slice(0,2)}-${e.slice(2,5)}-${e.slice(5)}`:e.length==10&&(a.value.phone=`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`)}function B(o){return o?o.split("T")[0]:"-"}return H(n,()=>{V.value=1},{deep:!0}),H(b,()=>{V.value=1}),(o,e)=>{const S=d("va-icon"),N=d("va-input"),k=d("va-button"),_=d("va-select"),de=d("va-alert"),T=d("va-checkbox"),me=d("va-pagination"),pe=d("va-date-input"),R=d("va-radio"),ve=d("va-textarea"),fe=d("va-chip");return f(),c("div",xe,[l("div",Ce,[e[37]||(e[37]=l("h1",{class:"page-title"},"사원 관리",-1)),l("div",ke,[l("div",Se,[s(N,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),placeholder:"사번, 이름으로 검색...",class:"search-input"},{prepend:y(()=>[s(S,{name:"search"})]),_:1},8,["modelValue"]),s(k,{onClick:oe},{default:y(()=>e[21]||(e[21]=[r("조회")])),_:1,__:[21]})]),l("div",Ne,[l("div",Ue,[e[22]||(e[22]=l("label",null,"사번",-1)),s(_,{modelValue:n.value.employeeId,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.employeeId=t),options:P.value,placeholder:"전체",clearable:""},null,8,["modelValue","options"])]),l("div",De,[e[23]||(e[23]=l("label",null,"이름",-1)),s(_,{modelValue:n.value.employeeName,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.employeeName=t),options:F.value,placeholder:"전체",clearable:""},null,8,["modelValue","options"])]),l("div",$e,[e[24]||(e[24]=l("label",null,"부서",-1)),s(_,{modelValue:n.value.department,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.department=t),options:Y.value,"value-by":"value","text-by":"text",placeholder:"전체",clearable:""},null,8,["modelValue","options"])]),l("div",Ie,[e[25]||(e[25]=l("label",null,"직급",-1)),s(_,{modelValue:n.value.position,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.position=t),options:L.value,placeholder:"전체",clearable:""},null,8,["modelValue","options"])]),l("div",Ee,[e[26]||(e[26]=l("label",null,"재직여부",-1)),s(_,{modelValue:n.value.employmentStatus,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.employmentStatus=t),options:X.value,"value-by":"value","text-by":"text",placeholder:"전체",clearable:""},null,8,["modelValue","options"])])])]),g(p)?(f(),c("div",Me,[s(k,{preset:"secondary",icon:"delete_outline",onClick:ue,disabled:v.value.length===0},{default:y(()=>e[27]||(e[27]=[r(" 삭제 ")])),_:1,__:[27]},8,["disabled"]),s(k,{preset:"secondary",icon:"download",onClick:ie},{default:y(()=>e[28]||(e[28]=[r(" 엑셀 ")])),_:1,__:[28]})])):(f(),c("div",Oe,[s(de,{color:"info",icon:"info"},{default:y(()=>e[29]||(e[29]=[r(" 조회 전용 모드입니다. 사원 관리는 관리자 권한이 필요합니다. ")])),_:1,__:[29]})])),l("div",Pe,[l("table",Fe,[l("thead",null,[l("tr",null,[g(p)?(f(),c("th",Ye,[s(T,{modelValue:$.value,"onUpdate:modelValue":[e[6]||(e[6]=t=>$.value=t),te]},null,8,["modelValue"])])):M("",!0),e[30]||(e[30]=l("th",null,"사번",-1)),e[31]||(e[31]=l("th",null,"이름",-1)),e[32]||(e[32]=l("th",null,"부서",-1)),e[33]||(e[33]=l("th",null,"직급",-1)),e[34]||(e[34]=l("th",null,"입사일",-1)),e[35]||(e[35]=l("th",null,"재직여부",-1))])]),l("tbody",null,[(f(!0),c(ge,null,Ve(z.value,(t,cl)=>{var j;return f(),c("tr",{key:t.employee_id,onClick:G=>g(p)?ae(t):null,class:be({selected:((j=w.value)==null?void 0:j.employee_id)===t.employee_id&&g(p),"read-only":!g(p)})},[g(p)?(f(),c("td",{key:0,onClick:e[8]||(e[8]=he(()=>{},["stop"]))},[s(T,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=G=>v.value=G),"array-value":t.employee_id},null,8,["modelValue","array-value"])])):M("",!0),l("td",null,m(t.employee_id),1),l("td",null,m(t.employee_name),1),l("td",null,m(le(t.department_code)),1),l("td",null,m(t.position),1),l("td",null,m(B(t.hire_date)),1),l("td",null,m(t.employment_status),1)],10,Le)}),128))])]),C.value.length===0?(f(),c("div",qe," 검색 결과가 없습니다. ")):M("",!0)]),l("div",ze,[l("div",Ae,m(q.value+1)+"-"+m(Math.min(V.value*b.value,C.value.length))+" of "+m(C.value.length),1),l("div",Be,[e[36]||(e[36]=l("span",null,"Rows per page: ",-1)),s(_,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value=t),options:[10,20,50],class:"rows-select"},null,8,["modelValue"]),s(me,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),pages:Z.value,"visible-pages":5,"buttons-preset":"secondary",rounded:"",gapped:"","border-color":"primary",class:"ml-3"},null,8,["modelValue","pages"])])])]),g(p)?(f(),c("div",Te,[l("div",Re,[e[39]||(e[39]=l("h2",null,"사원 등록/수정",-1)),l("div",je,[s(k,{preset:"secondary",onClick:A},{default:y(()=>e[38]||(e[38]=[r("초기화")])),_:1,__:[38]}),s(k,{onClick:ne},{default:y(()=>[r(m(w.value?"수정":"저장"),1)]),_:1})])]),l("div",Ge,[l("div",He,[l("div",Je,[e[40]||(e[40]=l("label",null,[r("이름 "),l("span",{class:"required"},"*")],-1)),s(N,{modelValue:a.value.employeeName,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.employeeName=t),placeholder:"이름을 입력하세요",error:i.value.employeeName,"error-messages":i.value.employeeName?"이름은 필수입니다":""},null,8,["modelValue","error","error-messages"])])]),l("div",Ke,[l("div",Qe,[e[41]||(e[41]=l("label",null,[r("부서 "),l("span",{class:"required"},"*")],-1)),s(_,{modelValue:a.value.departmentCode,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.departmentCode=t),options:Y.value,"value-by":"value","text-by":"text",placeholder:"부서를 선택하세요",error:i.value.departmentCode,"error-messages":i.value.departmentCode?"부서를 선택하세요":""},null,8,["modelValue","options","error","error-messages"])])]),l("div",We,[l("div",Xe,[e[42]||(e[42]=l("label",null,[r("직급 "),l("span",{class:"required"},"*")],-1)),s(_,{modelValue:a.value.position,"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.position=t),options:W.value,placeholder:"직급을 선택하세요",error:i.value.position,"error-messages":i.value.position?"직급을 선택하세요":""},null,8,["modelValue","options","error","error-messages"])])]),l("div",Ze,[l("div",el,[e[43]||(e[43]=l("label",null,"입사일",-1)),s(pe,{modelValue:a.value.hireDate,"onUpdate:modelValue":e[14]||(e[14]=t=>a.value.hireDate=t),error:i.value.hireDate,"error-messages":i.value.hireDate?"입사일을 선택하세요":""},null,8,["modelValue","error","error-messages"])])]),l("div",ll,[l("div",ol,[e[44]||(e[44]=l("label",null,"연락처",-1)),s(N,{modelValue:a.value.phone,"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.phone=t),placeholder:"숫자만 입력하세요",inputmode:"numeric",pattern:"[0-9]*",onInput:e[16]||(e[16]=t=>re(t.target.value)),maxlength:"15"},null,8,["modelValue"])])]),l("div",tl,[l("div",al,[e[45]||(e[45]=l("label",null,"이메일",-1)),s(N,{modelValue:a.value.email,"onUpdate:modelValue":e[17]||(e[17]=t=>a.value.email=t),placeholder:"example@company.com",type:"email"},null,8,["modelValue"])])]),l("div",sl,[l("div",nl,[e[48]||(e[48]=l("label",null,"재직여부",-1)),l("div",ul,[s(R,{modelValue:a.value.employmentStatus,"onUpdate:modelValue":e[18]||(e[18]=t=>a.value.employmentStatus=t),option:"Y"},{label:y(()=>e[46]||(e[46]=[l("span",{class:"radio-label"},"재직",-1)])),_:1},8,["modelValue"]),s(R,{modelValue:a.value.employmentStatus,"onUpdate:modelValue":e[19]||(e[19]=t=>a.value.employmentStatus=t),option:"N"},{label:y(()=>e[47]||(e[47]=[l("span",{class:"radio-label"},"퇴직",-1)])),_:1},8,["modelValue"])])])]),l("div",il,[l("div",rl,[e[49]||(e[49]=l("label",null,"비고",-1)),s(ve,{modelValue:a.value.remarks,"onUpdate:modelValue":e[20]||(e[20]=t=>a.value.remarks=t),placeholder:"비고사항을 입력하세요","min-rows":3,"max-rows":5},null,8,["modelValue"])])])])])):(f(),c("div",dl,[l("div",ml,[s(S,{name:"admin_panel_settings",size:"large",color:"primary"}),e[50]||(e[50]=l("h3",null,"사원 관리 권한 필요",-1)),e[51]||(e[51]=l("p",null,"사원 등록 및 수정은 관리자 권한이 필요합니다.",-1)),l("div",pl,[s(fe,{color:"info",size:"small"},{default:y(()=>[r(" 현재 권한: "+m(g(K)||"조회 전용"),1)]),_:1})]),e[52]||(e[52]=l("p",{class:"permission-desc"},[r(" 사원 목록은 조회할 수 있지만,"),l("br"),r(" 등록, 수정, 삭제는 관리자만 가능합니다. ")],-1))])]))])}}}),_l=we(vl,[["__scopeId","data-v-ffd8081d"]]);export{_l as default};
//# sourceMappingURL=EmployeeManagePage-BPpZ7UGk.js.map
