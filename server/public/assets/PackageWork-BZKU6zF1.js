import{_ as xe,v as W,n as f,c as X,o as Fe,K as Je,p as _,i as t,t as l,z as S,q as k,m as B,D as te,H as we,E as Ke,s as ye,F as Ve,y as He,J as Xe,h as Ye,a as je,A as Ze,f as p}from"./index-O14FyZ-J.js";const ze={class:"package-work-container"},et={class:"work-header"},tt={class:"header-info"},st={class:"header-left"},ot={class:"header-meta"},at={key:0,class:"workflow-badge"},lt={key:0,class:"workflow-indicator"},nt={key:0,class:"workflow-guide"},rt={class:"guide-content"},it={class:"guide-stats"},ut={key:0,class:"output-qty"},dt={class:"work-content"},ct={class:"work-layout"},vt={class:"work-main"},_t={class:"control-panel"},pt={class:"control-section"},mt={class:"control-row"},ft={class:"control-group"},wt={class:"control-label"},yt={key:0,class:"selected-count"},gt=["disabled"],kt={value:""},Tt=["value"],Nt={key:0,class:"no-work-message"},ht={class:"message-content"},bt={class:"message-text"},Rt={class:"message-help"},Dt={key:1,class:"loading-work-message"},St={class:"loading-content"},qt={class:"loading-help"},Et={class:"control-group"},$t={class:"control-display"},It={class:"display-value"},Ct={class:"control-row"},Ot={class:"control-group"},Pt={class:"control-display"},Wt={class:"control-group"},Bt={class:"control-display"},Mt={class:"display-value"},At={class:"control-row"},Qt={class:"control-group"},Gt=["disabled"],Lt={class:"control-group"},Ut={class:"control-label"},xt={key:0,class:"target-info"},Ft={key:1,class:"workflow-info"},Jt=["placeholder","disabled","max"],Kt={key:0,class:"workflow-linked-info"},Vt={class:"work-controls"},Ht={class:"main-actions"},Xt=["disabled"],Yt=["disabled"],jt=["disabled"],Zt={class:"sub-actions"},zt=["disabled"],es=["disabled"],ts={class:"progress-panel"},ss={class:"progress-cards"},os={class:"progress-card"},as={class:"card-value"},ls={class:"progress-card success"},ns={class:"card-value"},rs={class:"progress-card danger"},is={class:"card-value"},us={class:"progress-section"},ds={class:"progress-header"},cs={class:"progress-percent"},vs={class:"progress-bar"},_s={class:"log-panel"},ps={class:"log-container"},ms={class:"log-time"},fs={class:"log-content"},ws={class:"work-sidebar"},ys={key:0,class:"workflow-panel"},gs={class:"workflow-chain"},ks={class:"chain-step completed"},Ts={class:"step-details"},Ns={class:"detail-item"},hs={class:"detail-value"},bs={class:"detail-item"},Rs={class:"detail-value"},Ds={key:0,class:"detail-item"},Ss={class:"detail-value highlight"},qs={class:"chain-step current"},Es={class:"step-details"},$s={class:"detail-item"},Is={class:"detail-value"},Cs={class:"detail-item"},Os={class:"detail-value"},Ps={class:"info-panel"},Ws={class:"info-section"},Bs={class:"info-row"},Ms={class:"info-value"},As={class:"info-row"},Qs={class:"info-value"},Gs={class:"info-row"},Ls={class:"info-value"},Us={class:"info-row"},xs={class:"info-value"},Fs={class:"info-row"},Js={class:"info-value"},Ks={class:"info-section"},Vs={class:"info-row"},Hs={class:"info-value"},Xs={class:"info-row"},Ys={class:"info-row"},js={class:"info-value"},Zs={class:"info-row"},zs={class:"info-section"},eo={class:"info-row"},to={class:"info-value"},so={class:"info-row"},oo={class:"info-value"},ao={class:"info-row"},lo={class:"info-value work-duration"},no={class:"info-row"},ro={class:"info-section"},io={class:"info-row"},uo={class:"info-value worker-name"},co={class:"info-row"},vo={class:"info-value"},_o={class:"line-change-panel"},po={class:"line-change-help"},mo={class:"modal-header"},fo={class:"modal-body"},wo={class:"complete-summary"},yo={class:"summary-grid"},go={class:"summary-item"},ko={class:"summary-value"},To={class:"summary-item"},No={class:"summary-value"},ho={class:"summary-item"},bo={class:"summary-value"},Ro={class:"summary-item"},Do={class:"summary-value"},So={class:"summary-item"},qo={class:"summary-value"},Eo={class:"summary-item"},$o={class:"summary-value"},Io={key:0,class:"next-step-info inner-completion"},Co={key:1,class:"next-step-info outer-completion"},Oo={class:"confirmation-text"},Po={class:"modal-actions"},Wo={key:2,class:"auto-transition-overlay"},Bo={class:"transition-modal"},Mo={class:"transition-progress"},Ao={class:"progress-bar"},Qo={class:"progress-text"},Go={key:3,class:"loading-overlay"},Lo={class:"loading-text"},Uo={key:4,class:"error-overlay"},xo={class:"error-modal"},Fo={class:"error-body"},Jo={__name:"PackageWork",setup(Ko){W.defaults.timeout=15e3,W.defaults.headers.common["Content-Type"]="application/json";const Y=je(),T=Ze(),r=f({lineId:T.query.line_id||"1",lineName:T.query.line_name||"A라인 내포장",lineType:T.query.line_type||"INNER"});function O(s){if(!s)return"제품명 없음";const e={"BJA-STD-10":"베아제정","BJA-STD-30":"베아제정","BJA-STD-60":"베아제정","BJA-DR-10":"닥터베아제정","BJA-DR-30":"닥터베아제정","BJA-DR-60":"닥터베아제정","FST-GOLD-10":"헬스컵골드정","FST-GOLD-30":"헬스컵골드정","FST-GOLD-60":"헬스컵골드정","FST-PLUS-10":"헬스컵플러스정","FST-PLUS-30":"헬스컵플러스정","FST-PLUS-60":"헬스컵플러스정","GB-STD-10":"게보린정","GB-STD-30":"게보린정","GB-STD-60":"게보린정","GB-V-10":"게보린브이정","GB-V-30":"게보린브이정","GB-V-60":"게보린브이정","GN-Q-10":"그날엔큐정","GN-Q-30":"그날엔큐정","GN-Q-60":"그날엔큐정","GN-STD-10":"그날엔정","GN-STD-30":"그날엔정","GN-STD-60":"그날엔정","PCT-STD-10":"판코레아정","PCT-STD-30":"판코레아정","PCT-STD-60":"판코레아정","TN-500-10":"타이레놀정500mg","TN-500-30":"타이레놀정500mg","TN-500-60":"타이레놀정500mg","TN-8HR-10":"타이레놀정8시간 ER","TN-8HR-30":"타이레놀정8시간 ER","TN-8HR-60":"타이레놀정8시간 ER","TN-WMN-10":"타이레놀우먼스정","TN-WMN-30":"타이레놀우먼스정","TN-WMN-60":"타이레놀우먼스정"};if(e[s])return console.log(`제품명 매핑: ${s} -> ${e[s]}`),e[s];const i=s.replace(/-\d+$/,"");for(const[d,b]of Object.entries(e))if(d.startsWith(i))return console.log(`부분 매핑: ${s} -> ${b}`),b;return console.log(`매핑되지 않은 제품코드: ${s}`),s}function x(s){if(!s)return"제품명 없음";if(s.product_name&&!s.product_name.includes("제품")&&!s.product_name.includes("-"))return s.product_name;if(s.final_product_name&&!s.final_product_name.includes("제품")&&!s.final_product_name.includes("-"))return s.final_product_name;const e=s.product_code||R.value;return O(e)}const R=X(()=>{const s=r.value.lineName,e=r.value.lineId;if(console.log("제품코드 추출:",{lineName:s,lineId:e}),T.query.product_code)return console.log("URL에서 제품코드 전달받음:",T.query.product_code),T.query.product_code.toUpperCase();const i=[/([A-Z]{2,3}-[A-Z]{2,4}-\d+)/i,/([A-Z]{2,3}-[A-Z]{2}-\d+)/i,/(TN-\d+HR-\d+)/i,/(TN-WMN-\d+)/i,/(TN-\d+-\d+)/i];for(const $ of i){const E=s.match($);if(E)return console.log("라인명에서 제품코드 추출 성공:",E[1]),E[1].toUpperCase()}const d={닥터베아제정:"BJA-DR-10",베아제정:"BJA-STD-10",헬스컵골드정:"FST-GOLD-10",헬스컵플러스정:"FST-PLUS-10",게보린정:"GB-STD-10",게보린브이정:"GB-V-10",그날엔큐정:"GN-Q-10",그날엔정:"GN-STD-10",판코레아정:"PCT-STD-10",타이레놀정500mg:"TN-500-10",타이레놀정8시간:"TN-8HR-10",타이레놀우먼스정:"TN-WMN-10"};for(const[$,E]of Object.entries(d))if(s.includes($)){if(s.includes("30")||s.includes("30정")){const U=E.replace("-10","-30");return console.log(`제품명+용량 매핑: ${$} 30정 -> ${U}`),U}if(s.includes("60")||s.includes("60정")){const U=E.replace("-10","-60");return console.log(`제품명+용량 매핑: ${$} 60정 -> ${U}`),U}return console.log(`제품명 매핑: ${$} -> ${E}`),E}const b={"BJA-DR":"BJA-DR-10","BJA-STD":"BJA-STD-10","FST-GOLD":"FST-GOLD-10","FST-PLUS":"FST-PLUS-10","GB-STD":"GB-STD-10","GB-V":"GB-V-10","GN-Q":"GN-Q-10","GN-STD":"GN-STD-10","PCT-STD":"PCT-STD-10","TN-500":"TN-500-10","TN-8HR":"TN-8HR-10","TN-WMN":"TN-WMN-10"};for(const[$,E]of Object.entries(b))if(s.includes($))return console.log(`Prefix 매핑: ${$} -> ${E}`),E;return e.includes("A")||s.includes("A라인")?(console.log("A라인 감지, 베아제정 기본값"),"BJA-STD-10"):e.includes("B")||s.includes("B라인")?(console.log("B라인 감지, 베아제정 30정"),"BJA-STD-30"):e.includes("C")||s.includes("C라인")?(console.log("C라인 감지, 베아제정 60정"),"BJA-STD-60"):(console.log("제품코드 추출 실패, 기본값 BJA-STD-10 사용"),"BJA-STD-10")}),u=f({step:T.query.workflow_step||null,innerCompleted:T.query.inner_completed==="true",innerWorkNo:T.query.inner_work_order_no||"",innerCompletionTime:T.query.inner_completion_time?new Date(T.query.inner_completion_time):null,innerOutputQty:parseInt(T.query.inner_output_qty)||0,autoStartGuide:T.query.auto_start_guide==="true"}),q=f({success:!1,processGroupCode:"",order:0,processCode:""}),P=f({success:!1,resultId:"",previousStepCompleted:!1}),F=f(!1),A=f(!1),I=f(0),N=f(!1),C=f(""),j=f(!1),se=f(""),m=f("READY"),v=f(!1),J=f(null),Z=f("00:00:00"),y=f(""),D=f(500),n=f(null),o=f({work_order_no:"",work_id:"",result_detail_id:null,result_id:"",product_name:"",final_product_name:"",product_code:"",package_type:"",target_quantity:0,current_quantity:0,remaining_quantity:0,output_qty:0,defect_qty:0,progressRate:0,passRate:0,defectRate:0,achievementRate:0,employee_id:2,employee_name:"김홍인",department:"포장부",position:"작업자",start_time:null,actual_end_time:null,end_time:null,work_duration:0,estimated_duration:0,step_status:"READY",process_code:"",eq_type_code:""}),Q=f([]);let h=null,w=null;const ge=X(()=>{if(!o.value.end_time||!v.value)return!1;const s=new Date;return new Date(o.value.end_time).getTime()-s.getTime()<30*60*1e3}),g=f({productionSpeed:30,defectRate:.02,targetQty:0,currentProgress:0}),oe=X(()=>o.value.step_status==="부분완료"||o.value.step_status==="PARTIAL_COMPLETE"||o.value.step_status==="partial_complete"),ke=X(()=>!y.value||v.value?!1:oe.value||o.value.step_status==="일시정지"||o.value.step_status==="PAUSED"||o.value.step_status==="진행중"||o.value.step_status==="IN_PROGRESS"||o.value.step_status==="WORKING"?!0:D.value>0);Fe(async()=>{console.log("PackageWork 컴포넌트 마운트 시작 - 실제 제품명 매핑 적용"),console.log("라인 정보:",r.value),console.log("추출된 제품코드:",R.value),console.log("실제 제품명:",O(R.value)),console.log("워크플로우 정보:",u.value);try{if(N.value=!0,C.value=`${r.value.lineName}의 워크플로우를 실행하는 중... (제품: ${O(R.value)})`,await ae(),await le(),await ne(),await re(),r.value.lineType==="OUTER"&&await ie(),T.query.work_order_no&&n.value?(y.value=T.query.work_order_no,await M()):n.value&&(y.value=n.value.work_order_no||n.value.work_id,await M()),u.value.step==="OUTER"&&u.value.innerCompleted&&a(`외포장 단계입니다. 내포장(${u.value.innerWorkNo})이 완료되었습니다.`,"success"),T.query.message&&a(T.query.message,"success"),n.value){const s=x(n.value);a(`${r.value.lineName}에서 작업번호 ${n.value.work_order_no}를 로딩했습니다. (제품: ${s})`,"success"),a("테이블: work_order_master + work_result_detail","info")}else{const s=O(R.value);a(`${r.value.lineName}에 사용 가능한 작업번호가 없습니다. (제품: ${s})`,"warning"),a("work_order_master 테이블에서 조회됨","info")}}catch(s){console.error("워크플로우 실행 실패:",s),a(`워크플로우 실행 실패: ${s.message}`,"error"),n.value=null}finally{N.value=!1}});async function ae(){console.log("워크플로우 1단계: 라인ID, 제품코드 전달");const s=r.value.lineId,e=R.value;return a(`1단계: 라인ID(${s}), 제품코드(${e}) 전달 완료`,"info"),o.value.process_code=r.value.lineType==="INNER"?"p3":"p5",o.value.product_code=e,{lineId:s,productCode:e}}async function le(){console.log("워크플로우 2단계: 공정흐름도 정보 조회");try{const s=R.value,e=r.value.lineType==="INNER"?"p3":"p5";a(`2-1단계: 제품코드 ${s}의 공정흐름도 정보 조회 중...`,"info");const i={process_group_code:`${s}-Process`,order:r.value.lineType==="INNER"?1:2,process_code:e};return q.value={success:!0,processGroupCode:i.process_group_code,order:i.order,processCode:i.process_code},a(`공정흐름도 조회 성공: ${q.value.processGroupCode}`,"success"),q.value}catch(s){return console.error("공정흐름도 조회 실패:",s),q.value.success=!1,q.value={success:!0,processGroupCode:`${R.value}-Process`,order:r.value.lineType==="INNER"?1:2,processCode:r.value.lineType==="INNER"?"p3":"p5"},a(`공정흐름도 조회 실패, 기본값 사용: ${q.value.processGroupCode}`,"warning"),q.value}}async function ne(){console.log("워크플로우 3단계: 작업실적 조회");try{const s=q.value.processGroupCode,e=q.value.order-1;a(`2-2단계: 공정그룹코드 ${s}의 진행중인 실적 조회 중...`,"info");const i={result_id:`RES_${Date.now()}`,previous_step_completed:!0};return P.value={success:!0,resultId:i.result_id,previousStepCompleted:i.previous_step_completed},a(`작업실적 조회 성공: 실적ID ${P.value.resultId}`,"success"),P.value}catch(s){return console.error("작업실적 조회 실패:",s),P.value={success:!0,resultId:`RES_${Date.now()}`,previousStepCompleted:!0},a(`작업실적 조회 실패, 기본 실적ID 생성: ${P.value.resultId}`,"warning"),P.value}}async function re(){console.log("워크플로우 4단계: 작업번호 조회 (실제 제품명 매핑 적용)");try{const s=R.value,e=r.value.lineType,i=r.value.lineId;a(`2-3단계: 제품코드 ${s}의 ${e} 작업번호 조회 중...`,"info"),a(`API 경로: /packages/works/${e.toLowerCase()}/${i}`,"info");const d=await W.get(`/packages/works/${e.toLowerCase()}/${i}`,{params:{line_name:r.value.lineName,product_code:s}});if(console.log("API 응답:",d.data),d.data.success&&d.data.data){n.value=d.data.data;const b=x(n.value);return a(`DB에서 작업번호 조회 성공: ${n.value.work_order_no} (제품: ${b})`,"success"),a(`실적연동ID: ${n.value.result_detail_id}`,"info"),a(`데이터 소스: ${d.data.table_structure||"work_order_master + work_result_detail"}`,"success"),n.value}else throw new Error(d.data.message||"DB에서 작업번호를 찾을 수 없습니다")}catch(s){if(console.error("DB 연동 실패:",s),a(`DB 연동 실패: ${s.message}`,"error"),s.response&&s.response.status===404){const e=O(R.value);return a(`${r.value.lineName}에 대기중인 작업번호가 없습니다. (제품: ${e})`,"warning"),n.value=null,null}return s.code==="ECONNREFUSED"||s.code==="NETWORK_ERROR"?(a("서버 연결 실패. 서버 상태를 확인해주세요.","error"),G("서버에 연결할 수 없습니다. 서버 상태를 확인해주세요."),n.value=null,null):(a("실제 DB 연동에 실패했습니다. 관리자에게 문의하세요.","error"),G(`DB 연동 실패: ${s.message}`),n.value=null,null)}}async function ie(){try{console.log("외포장 워크플로우 데이터 로드 시작");const s=r.value.lineName.replace(/\s*(내포장|외포장).*$/,"");console.log("기본 라인명:",s);let e=null;try{const i=await W.get("/packages/workflow/inner-completed",{params:{base_line_name:s},headers:{"X-Workflow-Source":"PackageWork.vue","X-Table-Structure":"work_order_master + work_result_detail"}});i.data.success&&i.data.data&&(e=i.data.data,console.log("DB에서 내포장 완료 정보 조회 성공:",e))}catch(i){console.log("DB API 호출 실패, 대안 데이터 소스 확인:",i.message)}if(!e&&u.value.innerOutputQty>0&&(e={work_order_no:u.value.innerWorkNo,pass_qty:u.value.innerOutputQty,work_end_time:u.value.innerCompletionTime,code_value:"완료"},console.log("URL 파라미터에서 워크플로우 데이터 사용:",e)),!e&&window.workflowData){const i=`workflow_${s.replace(/\s+/g,"_")}`,d=window.workflowData[i];d&&d.inner_output_qty>0&&(e={work_order_no:d.inner_work_order_no,pass_qty:d.inner_output_qty,work_end_time:d.inner_completion_time,code_value:"완료"},console.log("메모리에서 워크플로우 데이터 사용:",e))}return e&&e.pass_qty>0?(u.value.innerCompleted=!0,u.value.innerWorkNo=e.work_order_no,u.value.innerOutputQty=e.pass_qty,u.value.innerCompletionTime=new Date(e.work_end_time||e.completion_time),u.value.step="OUTER",D.value=e.pass_qty,a(`3-1단계: ${s} 외포장에 워크플로우 연계 완료 (${c(e.pass_qty)}개)`,"success"),a(`완료 작업: ${e.work_order_no}, 완료수량: ${c(e.pass_qty)}개`,"info"),a("데이터 소스: work_result_detail 테이블","info"),!0):(console.log("연결된 내포장 완료 정보 없음"),a(`${s}의 내포장 완료 정보를 찾을 수 없습니다.`,"warning"),!1)}catch(s){return console.error("워크플로우 데이터 로드 실패:",s),a("워크플로우 연계에 실패했습니다. 수동으로 설정해주세요.","warning"),!1}}async function M(){if(!y.value||!n.value){ee();return}try{N.value=!0,C.value="작업 정보를 불러오는 중...",console.log(`선택된 작업번호: ${y.value}`),console.log("availableWork 원본 데이터:",n.value);const s=n.value.product_code||R.value,e=O(s);o.value={work_order_no:n.value.work_order_no||n.value.work_id,work_id:n.value.work_id,result_detail_id:n.value.result_detail_id,product_name:n.value.product_name&&!n.value.product_name.includes("제품")?n.value.product_name:e,final_product_name:n.value.final_product_name&&!n.value.final_product_name.includes("제품")?n.value.final_product_name:e,product_code:s,target_quantity:n.value.input_qty||n.value.target_qty||1e3,current_quantity:n.value.output_qty||0,remaining_quantity:(n.value.input_qty||n.value.target_qty||1e3)-(n.value.output_qty||0),output_qty:n.value.output_qty||0,defect_qty:0,progressRate:parseFloat(n.value.progress_rate)||0,passRate:0,defectRate:0,achievementRate:0,employee_id:n.value.employee_id||2,employee_name:n.value.employee_name||"김홍인",department:"포장부",position:n.value.position||"작업자",start_time:n.value.start_time,actual_end_time:n.value.actual_end_time,end_time:n.value.end_time,work_duration:0,estimated_duration:0,step_status:n.value.step_status||"READY",package_type:n.value.package_type||r.value.lineType,process_code:r.value.lineType==="INNER"?"p3":"p5",eq_type_code:"i8"},console.log("currentWork 객체로 변환 완료:",o.value),console.log(`실제 제품명 적용: ${e}`),r.value.lineType==="OUTER"&&u.value.innerCompleted&&u.value.innerOutputQty>0&&(console.log(`외포장 워크플로우 연계: ${u.value.innerOutputQty}개`),o.value.current_quantity=u.value.innerOutputQty,D.value=u.value.innerOutputQty,a(`워크플로우 연계: 내포장 완료수량 ${c(u.value.innerOutputQty)}개를 투입량으로 설정`,"success")),K(),a(`작업번호 ${y.value} 정보를 불러왔습니다.`,"success"),a(`제품명: ${e} (코드: ${s})`,"info"),a("데이터 소스: work_order_master + work_result_detail","success"),o.value.result_detail_id&&a(`실적 연동 활성화: ${o.value.result_detail_id}`,"success")}catch(s){console.error(`작업번호 ${y.value} 조회 실패:`,s),G(`작업번호 ${y.value} 정보를 불러올 수 없습니다: ${s.message}`),ee()}finally{N.value=!1}}async function Te(){if(v.value)de();else try{N.value=!0,C.value="작업을 시작하는 중... (DB 업데이트)";const s=new Date().toISOString();if(r.value.lineType==="INNER")try{await V("in_progress"),await ve(s),a("2-4단계: 내포장 작업 시작 - work_result_detail 테이블 업데이트","success"),a('- work_result_detail.code_value = "in_progress"',"info"),a("- work_result_detail.work_start_time 설정","info")}catch(i){console.error("내포장 워크플로우 시작 실패:",i.message),a("2-4단계: 내포장 워크플로우 시작 실패 - 로컬 모드로 진행","warning")}else try{await V("in_progress"),await ve(s),a("외포장 작업 시작 - work_result_detail 테이블 업데이트","success"),a('- work_result_detail.code_value = "in_progress"',"info"),a("- work_result_detail.work_start_time 설정","info")}catch(i){console.error("외포장 워크플로우 시작 실패:",i.message),a("외포장 워크플로우 시작 실패 - 로컬 모드로 진행","warning")}v.value=!0,m.value="WORKING",J.value=new Date(s),o.value.start_time=J.value,o.value.current_quantity=D.value,o.value.step_status="WORKING",g.value.targetQty=D.value,g.value.currentProgress=o.value.output_qty||0,K(),pe(),ue();const e=x(n.value);a(`${r.value.lineType==="INNER"?"내포장":"외포장"} 작업 시작: ${c(D.value)}개 (${e})`,"success")}catch(s){console.error("작업 시작 실패:",s),a(`작업 시작 실패: ${s.message}`,"error")}finally{N.value=!1}}async function Ne(){try{N.value=!0,C.value="작업을 완료하는 중... (DB 업데이트)";const s=new Date().toISOString(),e=o.value.output_qty||Math.floor(D.value*.95),i=o.value.defect_qty||Math.floor(D.value*.05);if(r.value.lineType==="INNER")try{await _e(s),await V("completed"),a("내포장 완료 처리:","success"),a("- work_result_detail.work_end_time 업데이트 완료","info"),a('- work_result_detail.code_value = "completed"',"info"),a("- DB 업데이트 성공","success")}catch(d){console.error("내포장 워크플로우 완료 실패:",d.message),a("내포장 워크플로우 완료 실패 - 로컬 모드로 완료","warning")}else try{await _e(s),await V("inspection"),a("3-2단계: 외포장 완료 처리:","success"),a("- work_result_detail.work_end_time 업데이트 완료","info"),a('- work_result_detail.code_value = "inspection"',"info"),a("- DB 업데이트 성공","success")}catch(d){console.error("외포장 워크플로우 완료 실패:",d.message),a("외포장 워크플로우 완료 실패 - 로컬 모드로 완료","warning")}r.value.lineType==="INNER"?(await he(),setTimeout(()=>{be()},2e3)):(a("모든 포장 작업이 완료되었습니다!","success"),a("work_result_detail 테이블 업데이트 완료","info"),setTimeout(()=>{Re()},3e3)),v.value=!1,m.value="COMPLETED",o.value.output_qty=e,o.value.defect_qty=i,o.value.actual_end_time=new Date(s),h&&(clearInterval(h),h=null),w&&(clearInterval(w),w=null),H()}catch(s){console.error("작업 완료 실패:",s),a(`작업 완료 처리 중 오류: ${s.message}`,"error")}finally{N.value=!1}}async function he(){try{console.log("내포장→외포장 워크플로우 연계 시작");const s=r.value.lineName.replace(/\s*(내포장|외포장).*$/,"");window.workflowData||(window.workflowData={});const e=`workflow_${s.replace(/\s+/g,"_")}`;window.workflowData[e]={inner_work_order_no:o.value.work_order_no||o.value.work_id,inner_output_qty:o.value.output_qty,inner_completion_time:new Date().toISOString(),completion_type:"complete"},a(`${s} 외포장에 워크플로우 연계 완료 (${c(o.value.output_qty)}개)`,"success")}catch(s){console.error("워크플로우 연계 실패:",s),a("외포장 연계에 실패했지만 작업은 완료되었습니다.","warning")}}function be(){a("지시량 달성 완료 - 외포장 라인 선택으로 이동합니다.","success");const s={inner_completed:"true",inner_work_order_no:o.value.work_order_no||o.value.work_id,inner_output_qty:o.value.output_qty,inner_completion_time:new Date().toISOString(),auto_start_guide:"true",workflow_type:"direct_transition",message:`내포장 작업(${o.value.work_order_no||o.value.work_id})이 완료되었습니다. 완료수량 ${c(o.value.output_qty)}개를 외포장에 투입하세요.`,success_message:"내포장 작업이 성공적으로 완료되었습니다!"};A.value=!0,I.value=0;const e=2e3,i=50,d=100/(e/i),b=setInterval(()=>{I.value+=d,I.value>=100&&(clearInterval(b),A.value=!1,Y.push({name:"package_line",query:s}))},i)}function Re(){console.log("자동 전환 시작"),A.value=!0,I.value=0;const s=3e3,e=50,i=100/(s/e),d=setInterval(()=>{if(I.value+=i,I.value>=100){clearInterval(d),A.value=!1;let b={};r.value.lineType==="INNER"?b={inner_completed:"true",prev_work:o.value.work_order_no||o.value.work_id,inner_work_order_no:o.value.work_order_no||o.value.work_id,inner_output_qty:o.value.output_qty,inner_completion_time:new Date().toISOString(),auto_start_guide:"true",message:`내포장 작업(${o.value.work_order_no||o.value.work_id})이 완료되었습니다. 완료수량 ${c(o.value.output_qty)}개를 외포장에 투입하세요.`,success_message:"내포장 작업이 성공적으로 완료되었습니다!"}:b={outer_completed:"true",prev_work:o.value.work_order_no||o.value.work_id,prev_inner_work:u.value.innerWorkNo,message:`모든 포장 작업이 완료되었습니다! 내포장(${u.value.innerWorkNo}) + 외포장(${o.value.work_order_no||o.value.work_id})`,success_message:"전체 포장 프로세스가 성공적으로 완료되었습니다!"},Y.push({name:"package_line",query:b})}},e)}async function z(){try{a("새로고침을 시작합니다...","info"),N.value=!0,C.value="새로고침 중...";const s=y.value;n.value=null,q.value.success=!1,P.value.success=!1,await new Promise(e=>setTimeout(e,500));try{await ae(),await le(),await ne(),await re(),r.value.lineType==="OUTER"&&await ie(),a("전체 워크플로우 재실행 완료","success")}catch(e){console.error("워크플로우 재실행 실패:",e),a(`워크플로우 오류: ${e.message}`,"error")}s&&n.value?n.value.work_order_no===s||n.value.work_id===s?(y.value=s,await M(),a(`이전 작업(${s})을 복원했습니다.`,"success")):(y.value=n.value.work_order_no||n.value.work_id,await M(),a("이전 작업을 찾을 수 없어 새 작업을 선택했습니다.","warning")):n.value&&(y.value=n.value.work_order_no||n.value.work_id,await M()),a("새로고침이 완료되었습니다.","success")}catch(s){console.error("새로고침 실패:",s),a(`새로고침 실패: ${s.message}`,"error")}finally{N.value=!1}}function ue(){w&&clearInterval(w),a("생산 시뮬레이션을 시작합니다...","info"),w=setInterval(()=>{if(!v.value)return;const s=g.value.productionSpeed;g.value.currentProgress=Math.min(g.value.currentProgress+s,g.value.targetQty);const e=g.value.currentProgress,i=Math.floor(e*g.value.defectRate),d=e-i,b=o.value.target_quantity||g.value.targetQty;o.value.output_qty=d,o.value.defect_qty=i,o.value.progressRate=Math.min(100,Math.round(d/b*100)),o.value.passRate=e>0?Math.round(d/e*100):0,o.value.defectRate=e>0?Math.round(i/e*100):0,K(),e>0&&e%(g.value.productionSpeed*5)===0&&a(`생산 진행: ${d}개 완료 (불량: ${i}개, 진행률: ${o.value.progressRate}%)`,"info"),e>=g.value.targetQty&&De()},1e3)}function De(){w&&(clearInterval(w),w=null),v.value=!1,m.value="COMPLETED",o.value.actual_end_time=new Date,a("생산이 완료되었습니다!","success"),a('"완료 처리" 버튼을 눌러 작업을 마무리해주세요.',"info")}function de(){v.value=!1,m.value="PAUSED",w&&(clearInterval(w),w=null),h&&(clearInterval(h),h=null),a("작업을 일시정지했습니다.","warning")}function Se(){v.value=!0,m.value="WORKING",pe(),ue(),a("작업을 재시작했습니다.","success")}async function qe(){try{v.value=!1,m.value="COMPLETED",o.value.actual_end_time=new Date,h&&(clearInterval(h),h=null),w&&(clearInterval(w),w=null),a("작업을 강제 종료했습니다.","info")}catch(s){console.error("작업 종료 실패:",s),G("작업 종료 처리에 실패했습니다.")}}async function Ee(){if(confirm("이 라인의 작업 상태를 초기화하시겠습니까?"))try{N.value=!0,C.value="라인 상태 초기화 중...",v.value=!1,m.value="READY",y.value="",D.value=500,ee(),h&&(clearInterval(h),h=null),w&&(clearInterval(w),w=null),a("라인 상태를 초기화했습니다.","success"),await z()}catch(s){console.error("라인 초기화 실패:",s),a(`라인 초기화 실패: ${s.message}`,"error")}finally{N.value=!1}}function $e(){if(y.value&&D.value>0){if(r.value.lineType==="OUTER"&&u.value.innerCompleted&&u.value.innerOutputQty>0){console.log("외포장 워크플로우 연계 중 - 투입수량 변경 제한");return}o.value.current_quantity=D.value,K()}}function K(){if(o.value.target_quantity>0?(o.value.remaining_quantity=Math.max(0,o.value.target_quantity-o.value.current_quantity),o.value.achievementRate=Math.round(o.value.output_qty/o.value.target_quantity*100)):(o.value.remaining_quantity=0,o.value.achievementRate=0),v.value&&g.value.productionSpeed>0){const e=(g.value.targetQty-g.value.currentProgress)/g.value.productionSpeed;o.value.end_time=new Date(Date.now()+e*1e3),o.value.estimated_duration=Math.ceil(e)}}function ee(){o.value={work_order_no:"",work_id:"",result_detail_id:null,result_id:"",product_name:"",final_product_name:"",product_code:"",package_type:"",target_quantity:0,current_quantity:0,remaining_quantity:0,output_qty:0,defect_qty:0,progressRate:0,passRate:0,defectRate:0,achievementRate:0,employee_id:2,worker_name:"",department:"포장부",position:"작업자",start_time:null,actual_end_time:null,end_time:null,work_duration:0,estimated_duration:0,step_status:"READY",process_code:"",eq_type_code:""}}function Ie(){if(m.value==="COMPLETED"||!v.value){F.value=!0;return}F.value=!0}function Ce(){m.value==="READY"?Te():m.value==="WORKING"?de():m.value==="PAUSED"&&Se()}function G(s){se.value=s,j.value=!0,a(s,"error")}function ce(){j.value=!1}async function Oe(){ce();try{await z()}catch{G("재연결에 실패했습니다.")}}async function V(s){try{(await W.post("/packages/workflow/start-inner",{work_order_no:o.value.work_order_no,product_code:o.value.product_code,process_group_code:q.value.processGroupCode},{headers:{"X-Workflow-Source":"PackageWork.vue","X-Table-Structure":"work_order_master + work_result_detail"}})).data.success&&a(`work_result_detail.code_value = "${s}" 업데이트 성공`,"success")}catch(e){throw console.error("work_result_detail 상태 업데이트 실패:",e),e}}async function ve(s){try{(await W.put("/packages/workflow/update-start-time",{work_order_no:o.value.work_order_no,start_time:s,result_detail_id:o.value.result_detail_id},{headers:{"X-Workflow-Source":"PackageWork.vue","X-Table-Structure":"work_order_master + work_result_detail"}})).data.success&&a("work_result_detail.work_start_time 업데이트 성공","success")}catch(e){throw console.error("work_result_detail 시작시간 업데이트 실패:",e),e}}async function _e(s){try{(await W.put("/packages/workflow/update-end-time",{work_order_no:o.value.work_order_no,end_time:s,result_detail_id:o.value.result_detail_id,pass_qty:o.value.output_qty,defect_qty:o.value.defect_qty},{headers:{"X-Workflow-Source":"PackageWork.vue","X-Table-Structure":"work_order_master + work_result_detail"}})).data.success&&a("work_result_detail.work_end_time 업데이트 성공","success")}catch(e){throw console.error("work_result_detail 종료시간 업데이트 실패:",e),e}}function pe(){h&&clearInterval(h),h=setInterval(()=>{if(v.value&&J.value){const e=new Date-J.value,i=Math.floor(e/(1e3*60*60)),d=Math.floor(e%(1e3*60*60)/(1e3*60)),b=Math.floor(e%(1e3*60)/1e3);Z.value=`${i.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`}},1e3)}function a(s,e="info"){const i={id:Date.now()+Math.random(),timestamp:new Date,message:s,type:e};Q.value.unshift(i),Q.value.length>100&&(Q.value=Q.value.slice(0,100))}function me(){v.value&&!confirm("작업 중입니다. 정말로 라인 선택 페이지로 돌아가시겠습니까?")||Y.push({name:"package_line"})}function H(){F.value=!1}function Pe(){return u.value.step==="OUTER"?"외포장":r.value.lineType==="INNER"?"내포장":"외포장"}function fe(s){return{READY:"대기",WORKING:"진행중",PAUSED:"일시정지",COMPLETED:"완료",PARTIAL_COMPLETE:"부분완료",partial_complete:"부분완료",부분완료:"부분완료",대기:"대기",진행중:"진행중",일시정지:"일시정지",완료:"완료",in_progress:"진행중",completed:"완료",inspection:"검사중"}[s]||s||"대기"}function We(){return m.value==="READY"?"작업 시작":m.value==="WORKING"?"일시정지":m.value==="PAUSED"?"재시작":"작업 시작"}function Be(){return r.value.lineType==="INNER"?"내포장 작업 완료":"외포장 작업 완료"}function Me(){return r.value.lineType==="INNER"?"내포장 작업을 완료하고 외포장 라인 선택으로 이동하시겠습니까?":"외포장 작업을 완료하고 전체 포장 프로세스를 마무리하시겠습니까?"}function Ae(){return r.value.lineType==="INNER"?"완료 후 외포장으로":"전체 완료"}function Qe(){return r.value.lineType==="INNER"?"외포장 라인 선택으로 이동 중...":"포장 라인 선택으로 이동 중..."}function Ge(){return r.value.lineType==="INNER"?"내포장 작업이 완료되었습니다. 외포장 라인을 선택하세요.":"모든 포장 작업이 완료되었습니다!"}function Le(s){return s>=100?"excellent":s>=80?"good":s>=60?"normal":"low"}function c(s){return s==null||s===void 0?"0":new Intl.NumberFormat("ko-KR").format(s)}function L(s){return!s||(typeof s=="string"&&(s=new Date(s)),!(s instanceof Date)||isNaN(s.getTime()))?"-":s.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Ue(s){return!s||(typeof s=="string"&&(s=new Date(s)),!(s instanceof Date)||isNaN(s.getTime()))?"-":s.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return Je(()=>{h&&clearInterval(h),w&&clearInterval(w)}),(s,e)=>(p(),_("div",ze,[t("div",et,[t("nav",{class:"breadcrumb"},[e[4]||(e[4]=t("span",{class:"breadcrumb-item"},"Home",-1)),e[5]||(e[5]=t("span",{class:"breadcrumb-separator"},"/",-1)),e[6]||(e[6]=t("span",{class:"breadcrumb-item"},"포장",-1)),e[7]||(e[7]=t("span",{class:"breadcrumb-separator"},"/",-1)),t("span",{class:"breadcrumb-item",onClick:me,style:{cursor:"pointer",color:"#3b82f6"}},"포장 라인 선택"),e[8]||(e[8]=t("span",{class:"breadcrumb-separator"},"/",-1)),e[9]||(e[9]=t("span",{class:"breadcrumb-item active"},"포장 작업 수행",-1))]),t("div",tt,[t("div",st,[t("h1",null,l(r.value.lineName)+" - "+l(Pe())+" 작업 수행",1),t("div",ot,[t("span",{class:S(["line-type-badge",r.value.lineType.toLowerCase()])},l(r.value.lineType==="INNER"?"내포장":"외포장"),3),t("span",{class:S(["work-status-badge",m.value.toLowerCase()])},l(fe(m.value)),3),u.value.step==="OUTER"?(p(),_("span",at," 2단계: 최종 포장 ")):k("",!0)])]),u.value.step?(p(),_("div",lt,[t("div",{class:S(["workflow-step",{completed:u.value.innerCompleted}])},e[10]||(e[10]=[t("div",{class:"step-text"},"내포장",-1)]),2),e[12]||(e[12]=t("div",{class:"workflow-arrow"},"->",-1)),t("div",{class:S(["workflow-step",{active:u.value.step==="OUTER"}])},e[11]||(e[11]=[t("div",{class:"step-text"},"외포장",-1)]),2)])):k("",!0)])]),u.value.step==="OUTER"&&u.value.innerCompleted?(p(),_("div",nt,[t("div",rt,[e[13]||(e[13]=t("h3",null,"외포장 작업 단계입니다",-1)),t("p",null,"내포장 작업("+l(u.value.innerWorkNo)+")이 완료되었습니다. 이제 최종 외포장 작업을 진행해주세요.",1),t("div",it,[t("span",null,"내포장 완료: "+l(L(u.value.innerCompletionTime)),1),u.value.innerOutputQty>0?(p(),_("span",ut," 완료수량: "+l(c(u.value.innerOutputQty))+"개 전달 ",1)):k("",!0)])])])):k("",!0),t("div",dt,[t("div",ct,[t("div",vt,[t("div",_t,[e[28]||(e[28]=t("div",{class:"panel-header"},[t("h3",null,"작업 제어")],-1)),t("div",pt,[t("div",mt,[t("div",ft,[t("label",wt,[e[14]||(e[14]=B(" 작업번호 선택 ")),y.value?(p(),_("span",yt)):k("",!0)]),te(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>y.value=i),onChange:M,class:"control-select",disabled:v.value},[t("option",kt,l(r.value.lineName)+"의 작업을 선택하세요",1),n.value?(p(),_("option",{key:0,value:n.value.work_order_no||n.value.work_id,class:"available-option"},l(n.value.work_order_no||n.value.work_id||"작업번호없음")+" - "+l(x(n.value)),9,Tt)):k("",!0)],40,gt),[[we,y.value]]),!n.value&&!N.value?(p(),_("div",Nt,[t("div",ht,[t("div",bt,[t("strong",null,l(r.value.lineName)+"의 "+l(r.value.lineType==="INNER"?"내포장":"외포장")+" 작업번호가 없습니다.",1)]),t("div",Rt,[B(" • 제품코드 "+l(R.value)+"로 work_order_master 테이블 조회 완료",1),e[15]||(e[15]=t("br",null,null,-1)),e[16]||(e[16]=B(" • 새로고침 버튼을 눌러보세요")),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=B(" • 또는 다른 라인을 선택해보세요 "))])])])):k("",!0),N.value&&C.value.includes("작업번호")?(p(),_("div",Dt,[t("div",St,[t("strong",null,l(r.value.lineName)+" 작업번호를 불러오는 중...",1),t("div",qt,"제품코드 "+l(R.value)+" 기반 (work_order_master 조인)",1)])])):k("",!0)]),t("div",Et,[e[20]||(e[20]=t("label",{class:"control-label"},"지시량",-1)),t("div",$t,[t("span",It,l(c(o.value.target_quantity)),1),e[19]||(e[19]=t("span",{class:"display-unit"},"개",-1))])])]),t("div",Ct,[t("div",Ot,[e[22]||(e[22]=t("label",{class:"control-label"},"기투입량",-1)),t("div",Pt,[t("span",{class:S(["display-value",{"workflow-linked":r.value.lineType==="OUTER"&&u.value.innerOutputQty>0}])},l(c(o.value.current_quantity)),3),e[21]||(e[21]=t("span",{class:"display-unit"},"개",-1))])]),t("div",Wt,[e[24]||(e[24]=t("label",{class:"control-label"},"미투입량",-1)),t("div",Bt,[t("span",Mt,l(c(o.value.remaining_quantity)),1),e[23]||(e[23]=t("span",{class:"display-unit"},"개",-1))])])]),t("div",At,[t("div",Qt,[e[26]||(e[26]=t("label",{class:"control-label"},"생산속도 (개/초)",-1)),te(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>g.value.productionSpeed=i),class:"control-select",disabled:v.value},e[25]||(e[25]=[t("option",{value:"10"},"느림 (10개/초)",-1),t("option",{value:"30"},"보통 (30개/초)",-1),t("option",{value:"60"},"빠름 (60개/초)",-1),t("option",{value:"100"},"매우빠름 (100개/초)",-1)]),8,Gt),[[we,g.value.productionSpeed,void 0,{number:!0}]])]),t("div",Lt,[t("label",Ut,[e[27]||(e[27]=B(" 투입수량 ")),o.value.target_quantity>0?(p(),_("span",xt," (지시: "+l(c(o.value.target_quantity))+"개) ",1)):k("",!0),r.value.lineType==="OUTER"&&u.value.innerOutputQty>0?(p(),_("span",Ft," (내포장 완료: "+l(c(u.value.innerOutputQty))+"개) ",1)):k("",!0)]),te(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>D.value=i),type:"number",class:S(["control-input",{"workflow-linked":r.value.lineType==="OUTER"&&u.value.innerOutputQty>0,"partial-work":oe.value}]),placeholder:r.value.lineType==="OUTER"&&u.value.innerOutputQty>0?u.value.innerOutputQty.toString():"500",disabled:!y.value||v.value||r.value.lineType==="OUTER"&&u.value.innerOutputQty>0,max:o.value.target_quantity,min:"1",onInput:$e},null,42,Jt),[[Ke,D.value,void 0,{number:!0}]]),r.value.lineType==="OUTER"&&u.value.innerOutputQty>0?(p(),_("div",Kt," 연계: 내포장 완료수량으로 자동 설정됨 ("+l(c(u.value.innerOutputQty))+"개) ",1)):k("",!0)])])]),t("div",Vt,[t("div",Ht,[t("button",{onClick:Ce,disabled:!ke.value&&!v.value&&m.value!=="PAUSED",class:S(["btn","btn-work",{working:v.value}])},l(We()),11,Xt),t("button",{onClick:Ie,disabled:!v.value&&m.value!=="COMPLETED",class:S(["btn","btn-complete",{ready:m.value==="COMPLETED"}])},l(m.value==="COMPLETED"?"완료 처리":"생산 완료"),11,Yt),t("button",{onClick:qe,disabled:!v.value,class:"btn btn-stop"}," 작업 종료 ",8,jt)]),t("div",Zt,[t("button",{onClick:z,disabled:N.value,class:"btn btn-refresh"}," 새로고침 ",8,zt),t("button",{onClick:Ee,disabled:N.value||v.value,class:"btn btn-reset",title:"라인 초기화"}," 초기화 ",8,es)])])]),t("div",ts,[e[36]||(e[36]=t("h3",null,"실시간 진행 상황",-1)),t("div",ss,[t("div",os,[e[29]||(e[29]=t("div",{class:"card-header"},[t("span",{class:"card-title"},"생산수량")],-1)),t("div",as,l(c(g.value.currentProgress)),1),e[30]||(e[30]=t("div",{class:"card-unit"},"개",-1))]),t("div",ls,[e[31]||(e[31]=t("div",{class:"card-header"},[t("span",{class:"card-title"},"합격수량")],-1)),t("div",ns,l(c(o.value.output_qty)),1),e[32]||(e[32]=t("div",{class:"card-unit"},"개",-1))]),t("div",rs,[e[33]||(e[33]=t("div",{class:"card-header"},[t("span",{class:"card-title"},"불량수량")],-1)),t("div",is,l(c(o.value.defect_qty)),1),e[34]||(e[34]=t("div",{class:"card-unit"},"개",-1))])]),t("div",us,[t("div",ds,[e[35]||(e[35]=t("span",null,"전체 진행률",-1)),t("span",cs,l(o.value.progressRate)+"%",1)]),t("div",vs,[t("div",{class:"progress-fill",style:ye({width:o.value.progressRate+"%"})},null,4)])])]),t("div",_s,[e[37]||(e[37]=t("h3",null,"작업 로그 (실제 DB 연동)",-1)),t("div",ps,[(p(!0),_(Ve,null,He(Q.value,i=>(p(),_("div",{key:i.id,class:S(["log-item",i.type])},[t("div",ms,l(Ue(i.timestamp)),1),t("div",fs,l(i.message),1)],2))),128))])])]),t("div",ws,[u.value.step==="OUTER"&&u.value.innerCompleted?(p(),_("div",ys,[e[46]||(e[46]=t("h3",null,"워크플로우 정보",-1)),t("div",gs,[t("div",ks,[e[41]||(e[41]=t("div",{class:"step-header"},[t("span",{class:"step-title"},"내포장 완료")],-1)),t("div",Ts,[t("div",Ns,[e[38]||(e[38]=t("span",{class:"detail-label"},"작업번호:",-1)),t("span",hs,l(u.value.innerWorkNo),1)]),t("div",bs,[e[39]||(e[39]=t("span",{class:"detail-label"},"완료시간:",-1)),t("span",Rs,l(L(u.value.innerCompletionTime)),1)]),u.value.innerOutputQty>0?(p(),_("div",Ds,[e[40]||(e[40]=t("span",{class:"detail-label"},"완료수량:",-1)),t("span",Ss,l(c(u.value.innerOutputQty))+"개",1)])):k("",!0)])]),e[45]||(e[45]=t("div",{class:"chain-arrow"},"전달",-1)),t("div",qs,[e[44]||(e[44]=t("div",{class:"step-header"},[t("span",{class:"step-title"},"외포장 진행")],-1)),t("div",Es,[t("div",$s,[e[42]||(e[42]=t("span",{class:"detail-label"},"라인:",-1)),t("span",Is,l(r.value.lineName),1)]),t("div",Cs,[e[43]||(e[43]=t("span",{class:"detail-label"},"상태:",-1)),t("span",Os,l(fe(m.value)),1)])])])])])):k("",!0),t("div",Ps,[e[65]||(e[65]=t("h3",null,"현재 작업 정보 (실제 DB 연동)",-1)),t("div",Ws,[t("div",Bs,[e[47]||(e[47]=t("span",{class:"info-label"},"라인 정보",-1)),t("span",Ms,l(r.value.lineName)+" ("+l(r.value.lineId)+")",1)]),t("div",As,[e[48]||(e[48]=t("span",{class:"info-label"},"제품코드",-1)),t("span",Qs,l(R.value),1)]),t("div",Gs,[e[49]||(e[49]=t("span",{class:"info-label"},"작업번호",-1)),t("span",Ls,l(o.value.work_order_no||o.value.work_id||"-"),1)]),t("div",Us,[e[50]||(e[50]=t("span",{class:"info-label"},"제품명",-1)),t("span",xs,l(o.value.product_name||o.value.final_product_name||O(R.value)),1)]),t("div",Fs,[e[51]||(e[51]=t("span",{class:"info-label"},"포장형태",-1)),t("span",Js,l(r.value.lineType==="INNER"?"내포장":"외포장"),1)])]),t("div",Ks,[e[56]||(e[56]=t("h4",null,"작업량 정보",-1)),t("div",Vs,[e[52]||(e[52]=t("span",{class:"info-label"},"지시량",-1)),t("span",Hs,l(c(o.value.target_quantity)||"-"),1)]),t("div",Xs,[e[53]||(e[53]=t("span",{class:"info-label"},"기투입량",-1)),t("span",{class:S(["info-value",{"workflow-linked":r.value.lineType==="OUTER"&&u.value.innerOutputQty>0}])},l(c(o.value.current_quantity)||"-"),3)]),t("div",Ys,[e[54]||(e[54]=t("span",{class:"info-label"},"미투입량",-1)),t("span",js,l(c(o.value.remaining_quantity)||"-"),1)]),t("div",Zs,[e[55]||(e[55]=t("span",{class:"info-label"},"달성률",-1)),t("span",{class:S(["info-value achievement-rate",Le(o.value.achievementRate)])},l(o.value.achievementRate)+"% ",3)])]),t("div",zs,[e[61]||(e[61]=t("h4",null,"시간 정보",-1)),t("div",eo,[e[57]||(e[57]=t("span",{class:"info-label"},"시작시간",-1)),t("span",to,l(L(o.value.start_time)),1)]),t("div",so,[e[58]||(e[58]=t("span",{class:"info-label"},"종료시간",-1)),t("span",oo,l(L(o.value.actual_end_time)),1)]),t("div",ao,[e[59]||(e[59]=t("span",{class:"info-label"},"작업시간",-1)),t("span",lo,l(Z.value),1)]),t("div",no,[e[60]||(e[60]=t("span",{class:"info-label"},"종료예정시간",-1)),t("span",{class:S(["info-value estimated-time",{"time-warning":ge.value}])},l(L(o.value.end_time)),3)])]),t("div",ro,[e[64]||(e[64]=t("h4",null,"담당자 정보",-1)),t("div",io,[e[62]||(e[62]=t("span",{class:"info-label"},"작업자명",-1)),t("span",uo,l(o.value.employee_name||"김홍인"),1)]),t("div",co,[e[63]||(e[63]=t("span",{class:"info-label"},"사번",-1)),t("span",vo,l(o.value.employee_id||"-"),1)])])]),t("div",_o,[t("button",{onClick:me,class:"btn-line-change"}," 다른 라인으로 변경하기 "),t("p",po,[e[66]||(e[66]=B(" 현재: ")),t("strong",null,l(r.value.lineName),1),e[67]||(e[67]=t("br",null,null,-1)),e[68]||(e[68]=B(" 잘못된 라인을 선택했거나 다른 라인에서 작업하고 싶다면 클릭하세요 "))])])])])]),F.value?(p(),_("div",{key:1,class:"modal-overlay",onClick:H},[t("div",{class:"modal-content",onClick:e[3]||(e[3]=Ye(()=>{},["stop"]))},[t("div",mo,[t("h3",null,l(Be()),1),t("button",{onClick:H,class:"modal-close"},"닫기")]),t("div",fo,[t("div",wo,[e[75]||(e[75]=t("h4",null,"작업 결과",-1)),t("div",yo,[t("div",go,[e[69]||(e[69]=t("span",{class:"summary-label"},"지시량",-1)),t("span",ko,l(c(o.value.target_quantity))+"개",1)]),t("div",To,[e[70]||(e[70]=t("span",{class:"summary-label"},"투입수량",-1)),t("span",No,l(c(o.value.current_quantity))+"개",1)]),t("div",ho,[e[71]||(e[71]=t("span",{class:"summary-label"},"합격수량",-1)),t("span",bo,l(c(o.value.output_qty))+"개",1)]),t("div",Ro,[e[72]||(e[72]=t("span",{class:"summary-label"},"불량수량",-1)),t("span",Do,l(c(o.value.defect_qty))+"개",1)]),t("div",So,[e[73]||(e[73]=t("span",{class:"summary-label"},"합격률",-1)),t("span",qo,l(o.value.passRate)+"%",1)]),t("div",Eo,[e[74]||(e[74]=t("span",{class:"summary-label"},"작업시간",-1)),t("span",$o,l(Z.value),1)])])]),r.value.lineType==="INNER"?(p(),_("div",Io,e[76]||(e[76]=[t("div",{class:"info-box"},[t("div",{class:"info-content"},[t("h5",null,"다음 단계: 외포장 라인 선택"),t("p",null,"내포장 작업 완료 후 work_result_detail 테이블에 종료시간이 업데이트되고 외포장 라인 선택 페이지로 이동합니다."),t("ul",null,[t("li",null,"work_result_detail.work_end_time 업데이트"),t("li",null,"work_result_detail.code_value = 'completed'"),t("li",null,"라인 선택 페이지로 자동 이동"),t("li",null,"외포장 라인 자동 활성화"),t("li",null,"완료수량 자동 연계")])])],-1)]))):r.value.lineType==="OUTER"?(p(),_("div",Co,e[77]||(e[77]=[Xe('<div class="info-box" data-v-685eec06><div class="info-content" data-v-685eec06><h5 data-v-685eec06>전체 포장 작업 완료!</h5><p data-v-685eec06>외포장 완료 시 work_result_detail 테이블에 종료시간이 업데이트되고 진행상태가 &#39;검사중&#39;으로 변경됩니다.</p><div class="completion-chain" data-v-685eec06><div class="chain-item" data-v-685eec06><span class="chain-text" data-v-685eec06>내포장</span><span class="chain-status" data-v-685eec06>완료</span></div><div class="chain-arrow" data-v-685eec06>다음</div><div class="chain-item" data-v-685eec06><span class="chain-text" data-v-685eec06>외포장</span><span class="chain-status" data-v-685eec06>완료</span></div></div><ul data-v-685eec06><li data-v-685eec06>work_result_detail.work_end_time 업데이트</li><li data-v-685eec06>work_result_detail.code_value = &#39;inspection&#39;</li><li data-v-685eec06>전체 포장 프로세스 완료</li></ul></div></div>',1)]))):k("",!0),t("p",Oo,l(Me()),1)]),t("div",Po,[t("button",{onClick:H,class:"btn-cancel"},"취소"),t("button",{onClick:Ne,class:"btn-confirm"},l(Ae()),1)])])])):k("",!0),A.value?(p(),_("div",Wo,[t("div",Bo,[t("h3",null,l(Qe()),1),t("p",null,l(Ge()),1),t("div",Mo,[t("div",Ao,[t("div",{class:"progress-fill",style:ye({width:I.value+"%"})},null,4)]),t("span",Qo,l(Math.round(I.value))+"%",1)])])])):k("",!0),N.value?(p(),_("div",Go,[e[78]||(e[78]=t("div",{class:"loading-spinner"},null,-1)),t("div",Lo,l(C.value),1)])):k("",!0),j.value?(p(),_("div",Uo,[t("div",xo,[e[80]||(e[80]=t("div",{class:"error-header"},[t("h3",null,"DB 연결 오류")],-1)),t("div",Fo,[t("p",null,l(se.value),1),e[79]||(e[79]=t("p",{class:"error-help"},"work_order_master 테이블 연결 상태를 확인하고 다시 시도해주세요.",-1))]),t("div",{class:"error-actions"},[t("button",{onClick:ce,class:"btn-error-close"},"확인"),t("button",{onClick:Oe,class:"btn-retry"},"다시 시도")])])])):k("",!0)]))}},Ho=xe(Jo,[["__scopeId","data-v-685eec06"]]);export{Ho as default};
//# sourceMappingURL=PackageWork-BZKU6zF1.js.map
